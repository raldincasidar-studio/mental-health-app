/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{358:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return ka})),n.d(e,"b",(function(){return Io})),n.d(e,"c",(function(){return To})),n.d(e,"d",(function(){return Sa})),n.d(e,"e",(function(){return Aa})),n.d(e,"f",(function(){return Ao})),n.d(e,"g",(function(){return da})),n.d(e,"h",(function(){return ha})),n.d(e,"i",(function(){return sa})),n.d(e,"j",(function(){return xa})),n.d(e,"k",(function(){return _a})),n.d(e,"l",(function(){return Da})),n.d(e,"m",(function(){return aa}));var r=n(578),o=n(599),c=n(608),h=n(564),l=n(693);const b="@firebase/firestore";class d{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}d.UNAUTHENTICATED=new d(null),d.GOOGLE_CREDENTIALS=new d("google-credentials-uid"),d.FIRST_PARTY=new d("first-party-uid"),d.MOCK_USER=new d("mock-user");let f="9.22.0";const m=new c.b("@firebase/firestore");function y(){return m.logLevel}function v(t,...e){if(m.logLevel<=c.a.DEBUG){const n=e.map(I);m.debug(`Firestore (${f}): ${t}`,...n)}}function w(t,...e){if(m.logLevel<=c.a.ERROR){const n=e.map(I);m.error(`Firestore (${f}): ${t}`,...n)}}function E(t,...e){if(m.logLevel<=c.a.WARN){const n=e.map(I);m.warn(`Firestore (${f}): ${t}`,...n)}}function I(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function T(t="Unexpected state"){const e=`FIRESTORE (${f}) INTERNAL ASSERTION FAILED: `+t;throw w(e),new Error(e)}function S(t,e){t||T()}function C(t,e){return t}const q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class A extends h.c{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class _{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class D{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class k{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(d.UNAUTHENTICATED)))}shutdown(){}}class N{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class O{constructor(t){this.t=t,this.currentUser=d.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const s=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new _;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new _,t.enqueueRetryable((()=>s(this.currentUser)))};const r=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await s(this.currentUser)}))},o=t=>{v("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),r()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(v("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new _)}}),0),r()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(v("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(S("string"==typeof e.accessToken),new D(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return S(null===t||"string"==typeof t),new d(t)}}class x{constructor(t,e,n){this.h=t,this.l=e,this.m=n,this.type="FirstParty",this.user=d.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const t=this.p();return t&&this.g.set("Authorization",t),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class R{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new x(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(d.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class M{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class L{constructor(t){this.I=t,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(t,e){const n=t=>{null!=t.error&&v("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.T;return this.T=t.token,v("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const s=t=>{v("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.I.onInit((t=>s(t))),setTimeout((()=>{if(!this.appCheck){const t=this.I.getImmediate({optional:!0});t?s(t):v("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(S("string"==typeof t.token),this.T=t.token,new M(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function P(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class F{static A(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(256/62);let n="";for(;n.length<20;){const s=P(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%62))}return n}}function V(t,e){return t<e?-1:t>e?1:0}function U(t,e,n){return t.length===e.length&&t.every(((t,s)=>n(t,e[s])))}class j{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new A(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new A(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new A(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new A(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return j.fromMillis(Date.now())}static fromDate(t){return j.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new j(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?V(this.nanoseconds,t.nanoseconds):V(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class rt{constructor(t){this.timestamp=t}static fromTimestamp(t){return new rt(t)}static min(){return new rt(new j(0,0))}static max(){return new rt(new j(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class B{constructor(t,e,n){void 0===e?e=0:e>t.length&&T(),void 0===n?n=t.length-e:n>t.length-e&&T(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===B.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof B?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class $ extends B{construct(t,e,n){return new $(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new A(q.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new $(e)}static emptyPath(){return new $([])}}const z=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class K extends B{construct(t,e,n){return new K(t,e,n)}static isValidIdentifier(t){return z.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),K.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new K(["__name__"])}static fromServerFormat(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new A(q.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new A(q.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new A(q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new A(q.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new K(e)}static emptyPath(){return new K([])}}class G{constructor(t){this.path=t}static fromPath(t){return new G($.fromString(t))}static fromName(t){return new G($.fromString(t).popFirst(5))}static empty(){return new G($.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===$.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return $.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new G(new $(t.slice()))}}class H{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}}H.UNKNOWN_ID=-1;function Q(t,e){const n=t.toTimestamp().seconds,s=t.toTimestamp().nanoseconds+1,i=rt.fromTimestamp(1e9===s?new j(n+1,0):new j(n,s));return new Y(i,G.empty(),e)}function W(t){return new Y(t.readTime,t.key,-1)}class Y{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Y(rt.min(),G.empty(),-1)}static max(){return new Y(rt.max(),G.empty(),-1)}}function X(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=G.comparator(t.documentKey,e.documentKey),0!==n?n:V(t.largestBatchId,e.largestBatchId))}const J="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Z{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function tt(t){if(t.code!==q.FAILED_PRECONDITION||t.message!==J)throw t;v("LocalStore","Unexpectedly lost primary lease")}class et{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&T(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new et(((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,s)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof et?e:et.resolve(e)}catch(t){return et.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):et.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):et.reject(e)}static resolve(t){return new et(((e,n)=>{e(t)}))}static reject(t){return new et(((e,n)=>{n(t)}))}static waitFor(t){return new et(((e,n)=>{let s=0,i=0,r=!1;t.forEach((t=>{++s,t.next((()=>{++i,r&&i===s&&e()}),(t=>n(t)))})),r=!0,i===s&&e()}))}static or(t){let e=et.resolve(!1);for(const n of t)e=e.next((t=>t?et.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,s)=>{n.push(e.call(this,t,s))})),this.waitFor(n)}static mapArray(t,e){return new et(((n,s)=>{const i=t.length,r=new Array(i);let o=0;for(let u=0;u<i;u++){const c=u;e(t[c]).next((t=>{r[c]=t,++o,o===i&&n(r)}),(t=>s(t)))}}))}static doWhile(t,e){return new et(((n,s)=>{const i=()=>{!0===t()?e().next((()=>{i()}),s):n()};i()}))}}function nt(t){return"IndexedDbTransactionError"===t.name}class it{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ot(t),this.ut=t=>e.writeSequenceNumber(t))}ot(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ut&&this.ut(t),t}}function st(t){return null==t}function ot(t){return 0===t&&1/t==-1/0}function at(t){return"number"==typeof t&&Number.isInteger(t)&&!ot(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}it.ct=-1;const ct=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ut=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ht=ut;function lt(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ft(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function pt(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class gt{constructor(t,e){this.comparator=t,this.root=e||yt.EMPTY}insert(t,e){return new gt(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,yt.BLACK,null,null))}remove(t){return new gt(this.comparator,this.root.remove(t,this.comparator).copy(null,null,yt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new mt(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new mt(this.root,t,this.comparator,!1)}getReverseIterator(){return new mt(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new mt(this.root,t,this.comparator,!0)}}class mt{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&s&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class yt{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:yt.RED,this.left=null!=s?s:yt.EMPTY,this.right=null!=i?i:yt.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new yt(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const i=n(t,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return yt.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return yt.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,yt.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,yt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw T();if(this.right.isRed())throw T();const t=this.left.check();if(t!==this.right.check())throw T();return t+(this.isRed()?0:1)}}yt.EMPTY=null,yt.RED=!0,yt.BLACK=!1,yt.EMPTY=new class{constructor(){this.size=0}get key(){throw T()}get value(){throw T()}get color(){throw T()}get left(){throw T()}get right(){throw T()}copy(t,e,n,s,i){return this}insert(t,e,n){return new yt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class vt{constructor(t){this.comparator=t,this.data=new gt(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new wt(this.data.getIterator())}getIteratorFrom(t){return new wt(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof vt))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new vt(this.comparator);return e.data=t,e}}class wt{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class bt{constructor(t){this.fields=t,t.sort(K.comparator)}static empty(){return new bt([])}unionWith(t){let e=new vt(K.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new bt(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return U(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Et extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class It{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Et("Invalid base64 string: "+t):t}}(t);return new It(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new It(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return V(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}It.EMPTY_BYTE_STRING=new It("");const Tt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function St(t){if(S(!!t),"string"==typeof t){let e=0;const n=Tt.exec(t);if(S(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:Ct(t.seconds),nanos:Ct(t.nanos)}}function Ct(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function At(t){return"string"==typeof t?It.fromBase64String(t):It.fromUint8Array(t)}function _t(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Dt(t){const e=t.mapValue.fields.__previous_value__;return _t(e)?Dt(e):e}function kt(t){const e=St(t.mapValue.fields.__local_write_time__.timestampValue);return new j(e.seconds,e.nanos)}class Nt{constructor(t,e,n,s,i,r,o,u,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.longPollingOptions=u,this.useFetchStreams=c}}class Ot{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Ot("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Ot&&t.projectId===this.projectId&&t.database===this.database}}const xt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Rt(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?_t(t)?4:Ht(t)?9007199254740991:10:T()}function Mt(t,e){if(t===e)return!0;const n=Rt(t);if(n!==Rt(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return kt(t).isEqual(kt(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=St(t.timestampValue),s=St(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return At(t.bytesValue).isEqual(At(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ct(t.geoPointValue.latitude)===Ct(e.geoPointValue.latitude)&&Ct(t.geoPointValue.longitude)===Ct(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ct(t.integerValue)===Ct(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Ct(t.doubleValue),s=Ct(e.doubleValue);return n===s?ot(n)===ot(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return U(t.arrayValue.values||[],e.arrayValue.values||[],Mt);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(lt(n)!==lt(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!Mt(n[t],s[t])))return!1;return!0}(t,e);default:return T()}}function Lt(t,e){return void 0!==(t.values||[]).find((t=>Mt(t,e)))}function Pt(t,e){if(t===e)return 0;const n=Rt(t),s=Rt(e);if(n!==s)return V(n,s);switch(n){case 0:case 9007199254740991:return 0;case 1:return V(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Ct(t.integerValue||t.doubleValue),s=Ct(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return Ft(t.timestampValue,e.timestampValue);case 4:return Ft(kt(t),kt(e));case 5:return V(t.stringValue,e.stringValue);case 6:return function(t,e){const n=At(t),s=At(e);return n.compareTo(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=V(n[t],s[t]);if(0!==e)return e}return V(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=V(Ct(t.latitude),Ct(e.latitude));return 0!==n?n:V(Ct(t.longitude),Ct(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=Pt(n[t],s[t]);if(e)return e}return V(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===xt.mapValue&&e===xt.mapValue)return 0;if(t===xt.mapValue)return 1;if(e===xt.mapValue)return-1;const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=V(s[t],r[t]);if(0!==e)return e;const o=Pt(n[s[t]],i[r[t]]);if(0!==o)return o}return V(s.length,r.length)}(t.mapValue,e.mapValue);default:throw T()}}function Ft(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return V(t,e);const n=St(t),s=St(e),i=V(n.seconds,s.seconds);return 0!==i?i:V(n.nanos,s.nanos)}function Vt(t){return Ut(t)}function Ut(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=St(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?At(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,G.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=Ut(s);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const i of e)s?s=!1:n+=",",n+=`${i}:${Ut(t.fields[i])}`;return n+"}"}(t.mapValue):T();var e,n}function jt(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Bt(t){return!!t&&"integerValue"in t}function qt(t){return!!t&&"arrayValue"in t}function $t(t){return!!t&&"nullValue"in t}function zt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Kt(t){return!!t&&"mapValue"in t}function Gt(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return ft(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Gt(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Gt(t.arrayValue.values[n]);return e}return Object.assign({},t)}function Ht(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class Qt{constructor(t){this.value=t}static empty(){return new Qt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Kt(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Gt(e)}setAll(t){let e=K.emptyPath(),n={},s=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s),n={},s=[],e=i.popLast()}t?n[i.lastSegment()]=Gt(t):s.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,s)}delete(t){const e=this.field(t.popLast());Kt(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Mt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Kt(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){ft(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Qt(Gt(this.value))}}function Wt(t){const e=[];return ft(t.fields,((t,n)=>{const s=new K([t]);if(Kt(n)){const t=Wt(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)})),new bt(e)}class Yt{constructor(t,e,n,s,i,r,o){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.createTime=i,this.data=r,this.documentState=o}static newInvalidDocument(t){return new Yt(t,0,rt.min(),rt.min(),rt.min(),Qt.empty(),0)}static newFoundDocument(t,e,n,s){return new Yt(t,1,e,rt.min(),n,s,0)}static newNoDocument(t,e){return new Yt(t,2,e,rt.min(),rt.min(),Qt.empty(),0)}static newUnknownDocument(t,e){return new Yt(t,3,e,rt.min(),rt.min(),Qt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(rt.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Qt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Qt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=rt.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Yt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Yt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Xt{constructor(t,e){this.position=t,this.inclusive=e}}function Jt(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.isKeyField()?G.comparator(G.fromName(o.referenceValue),n.key):Pt(o,n.data.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return s}function Zt(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Mt(t.position[n],e.position[n]))return!1;return!0}class te{constructor(t,e="asc"){this.field=t,this.dir=e}}function ee(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class ne{}class ie extends ne{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new le(t,e,n):"array-contains"===e?new ge(t,n):"in"===e?new me(t,n):"not-in"===e?new ye(t,n):"array-contains-any"===e?new ve(t,n):new ie(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new de(t,n):new fe(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Pt(e,this.value)):null!==e&&Rt(this.value)===Rt(e)&&this.matchesComparison(Pt(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return T()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class re extends ne{constructor(t,e){super(),this.filters=t,this.op=e,this.lt=null}static create(t,e){return new re(t,e)}matches(t){return se(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const t=this.ft((t=>t.isInequality()));return null!==t?t.field:null}ft(t){for(const e of this.getFlattenedFilters())if(t(e))return e;return null}}function se(t){return"and"===t.op}function oe(t){return ae(t)&&se(t)}function ae(t){for(const e of t.filters)if(e instanceof re)return!1;return!0}function ce(t){if(t instanceof ie)return t.field.canonicalString()+t.op.toString()+Vt(t.value);if(oe(t))return t.filters.map((t=>ce(t))).join(",");{const e=t.filters.map((t=>ce(t))).join(",");return`${t.op}(${e})`}}function ue(t,e){return t instanceof ie?function(t,e){return e instanceof ie&&t.op===e.op&&t.field.isEqual(e.field)&&Mt(t.value,e.value)}(t,e):t instanceof re?function(t,e){return e instanceof re&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,s)=>t&&ue(n,e.filters[s])),!0)}(t,e):void T()}function he(t){return t instanceof ie?function(t){return`${t.field.canonicalString()} ${t.op} ${Vt(t.value)}`}(t):t instanceof re?function(t){return t.op.toString()+" {"+t.getFilters().map(he).join(" ,")+"}"}(t):"Filter"}class le extends ie{constructor(t,e,n){super(t,e,n),this.key=G.fromName(n.referenceValue)}matches(t){const e=G.comparator(t.key,this.key);return this.matchesComparison(e)}}class de extends ie{constructor(t,e){super(t,"in",e),this.keys=pe("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class fe extends ie{constructor(t,e){super(t,"not-in",e),this.keys=pe("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function pe(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>G.fromName(t.referenceValue)))}class ge extends ie{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return qt(e)&&Lt(e.arrayValue,this.value)}}class me extends ie{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Lt(this.value.arrayValue,e)}}class ye extends ie{constructor(t,e){super(t,"not-in",e)}matches(t){if(Lt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Lt(this.value.arrayValue,e)}}class ve extends ie{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!qt(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Lt(this.value.arrayValue,t)))}}class we{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.dt=null}}function be(t,e=null,n=[],s=[],i=null,r=null,o=null){return new we(t,e,n,s,i,r,o)}function Ee(t){const e=C(t);if(null===e.dt){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>ce(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),st(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Vt(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Vt(t))).join(",")),e.dt=t}return e.dt}function Ie(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!ee(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!ue(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Zt(t.startAt,e.startAt)&&Zt(t.endAt,e.endAt)}function Te(t){return G.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Se{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,u=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=r,this.startAt=o,this.endAt=u,this.wt=null,this._t=null,this.startAt,this.endAt}}function Ce(t,e,n,s,i,r,o,u){return new Se(t,e,n,s,i,r,o,u)}function Ae(t){return new Se(t)}function _e(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function De(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function ke(t){for(const e of t.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function Ne(t){return null!==t.collectionGroup}function Oe(t){const e=C(t);if(null===e.wt){e.wt=[];const t=ke(e),n=De(e);if(null!==t&&null===n)t.isKeyField()||e.wt.push(new te(t)),e.wt.push(new te(K.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.wt.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new te(K.keyField(),t))}}}return e.wt}function xe(t){const e=C(t);if(!e._t)if("F"===e.limitType)e._t=be(e.path,e.collectionGroup,Oe(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of Oe(e)){const e="desc"===n.dir?"asc":"desc";t.push(new te(n.field,e))}const n=e.endAt?new Xt(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new Xt(e.startAt.position,e.startAt.inclusive):null;e._t=be(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e._t}function Re(t,e){e.getFirstInequalityField(),ke(t);const n=t.filters.concat([e]);return new Se(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Me(t,e,n){return new Se(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Le(t,e){return Ie(xe(t),xe(e))&&t.limitType===e.limitType}function Pe(t){return`${Ee(xe(t))}|lt:${t.limitType}`}function Fe(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>he(t))).join(", ")}]`),st(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Vt(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Vt(t))).join(",")),`Target(${e})`}(xe(t))}; limitType=${t.limitType})`}function Ve(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):G.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Oe(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const s=Jt(t,e,n);return t.inclusive?s<=0:s<0}(t.startAt,Oe(t),e))&&!(t.endAt&&!function(t,e,n){const s=Jt(t,e,n);return t.inclusive?s>=0:s>0}(t.endAt,Oe(t),e))}(t,e)}function Ue(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function je(t){return(e,n)=>{let s=!1;for(const i of Oe(t)){const t=Be(i,e,n);if(0!==t)return t;s=s||i.field.isKeyField()}return 0}}function Be(t,e,n){const s=t.field.isKeyField()?G.comparator(e.key,n.key):function(t,e,n){const s=e.data.field(t),i=n.data.field(t);return null!==s&&null!==i?Pt(s,i):T()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return T()}}class qe{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,s]of n)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(void 0===s)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(t){ft(this.inner,((e,n)=>{for(const[e,s]of n)t(e,s)}))}isEmpty(){return pt(this.inner)}size(){return this.innerSize}}const $e=new gt(G.comparator);function ze(){return $e}const Ke=new gt(G.comparator);function Ge(...t){let e=Ke;for(const n of t)e=e.insert(n.key,n);return e}function He(t){let e=Ke;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function Qe(){return Ye()}function We(){return Ye()}function Ye(){return new qe((t=>t.toString()),((t,e)=>t.isEqual(e)))}const Xe=new gt(G.comparator),Je=new vt(G.comparator);function Ze(...t){let e=Je;for(const n of t)e=e.add(n);return e}const tn=new vt(V);function en(){return tn}function nn(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ot(e)?"-0":e}}function rn(t){return{integerValue:""+t}}function sn(t,e){return at(e)?rn(e):nn(t,e)}class on{constructor(){this._=void 0}}function an(t,e,n){return t instanceof hn?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&_t(e)&&(e=Dt(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof ln?dn(t,e):t instanceof fn?pn(t,e):function(t,e){const n=un(t,e),s=mn(n)+mn(t.gt);return Bt(n)&&Bt(t.gt)?rn(s):nn(t.serializer,s)}(t,e)}function cn(t,e,n){return t instanceof ln?dn(t,e):t instanceof fn?pn(t,e):n}function un(t,e){return t instanceof gn?Bt(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class hn extends on{}class ln extends on{constructor(t){super(),this.elements=t}}function dn(t,e){const n=yn(e);for(const e of t.elements)n.some((t=>Mt(t,e)))||n.push(e);return{arrayValue:{values:n}}}class fn extends on{constructor(t){super(),this.elements=t}}function pn(t,e){let n=yn(e);for(const e of t.elements)n=n.filter((t=>!Mt(t,e)));return{arrayValue:{values:n}}}class gn extends on{constructor(t,e){super(),this.serializer=t,this.gt=e}}function mn(t){return Ct(t.integerValue||t.doubleValue)}function yn(t){return qt(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class vn{constructor(t,e){this.field=t,this.transform=e}}class wn{constructor(t,e){this.version=t,this.transformResults=e}}class bn{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new bn}static exists(t){return new bn(void 0,t)}static updateTime(t){return new bn(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function En(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class In{}function Tn(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Rn(t.key,bn.none()):new Dn(t.key,t.data,bn.none());{const n=t.data,s=Qt.empty();let i=new vt(K.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?s.delete(t):s.set(t,e),i=i.add(t)}return new kn(t.key,s,new bt(i.toArray()),bn.none())}}function Sn(t,e,n){t instanceof Dn?function(t,e,n){const s=t.value.clone(),i=On(t.fieldTransforms,e,n.transformResults);s.setAll(i),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):t instanceof kn?function(t,e,n){if(!En(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=On(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Nn(t)),i.setAll(s),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Cn(t,e,n,s){return t instanceof Dn?function(t,e,n,s){if(!En(t.precondition,e))return n;const i=t.value.clone(),r=xn(t.fieldTransforms,s,e);return i.setAll(r),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,s):t instanceof kn?function(t,e,n,s){if(!En(t.precondition,e))return n;const i=xn(t.fieldTransforms,s,e),r=e.data;return r.setAll(Nn(t)),r.setAll(i),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,s):function(t,e,n){return En(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function An(t,e){let n=null;for(const s of t.fieldTransforms){const t=e.data.field(s.field),i=un(s.transform,t||null);null!=i&&(null===n&&(n=Qt.empty()),n.set(s.field,i))}return n||null}function _n(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&U(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof ln&&e instanceof ln||t instanceof fn&&e instanceof fn?U(t.elements,e.elements,Mt):t instanceof gn&&e instanceof gn?Mt(t.gt,e.gt):t instanceof hn&&e instanceof hn}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Dn extends In{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class kn extends In{constructor(t,e,n,s,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Nn(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}})),e}function On(t,e,n){const s=new Map;S(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform,u=e.data.field(r.field);s.set(r.field,cn(o,u,n[i]))}return s}function xn(t,e,n){const s=new Map;for(const i of t){const t=i.transform,r=n.data.field(i.field);s.set(i.field,an(t,r,e))}return s}class Rn extends In{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Mn extends In{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ln{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&Sn(s,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Cn(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Cn(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=We();return this.mutations.forEach((s=>{const i=t.get(s.key),r=i.overlayedDocument;let o=this.applyToLocalView(r,i.mutatedFields);o=e.has(s.key)?null:o;const u=Tn(r,o);null!==u&&n.set(s.key,u),r.isValidDocument()||r.convertToNoDocument(rt.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Ze())}isEqual(t){return this.batchId===t.batchId&&U(this.mutations,t.mutations,((t,e)=>_n(t,e)))&&U(this.baseMutations,t.baseMutations,((t,e)=>_n(t,e)))}}class Pn{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){S(t.mutations.length===n.length);let s=Xe;const i=t.mutations;for(let t=0;t<i.length;t++)s=s.insert(i[t].key,n[t].version);return new Pn(t,e,n,s)}}class Fn{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Vn{constructor(t,e){this.count=t,this.unchangedNames=e}}var Un,jn;function Bn(t){switch(t){default:return T();case q.CANCELLED:case q.UNKNOWN:case q.DEADLINE_EXCEEDED:case q.RESOURCE_EXHAUSTED:case q.INTERNAL:case q.UNAVAILABLE:case q.UNAUTHENTICATED:return!1;case q.INVALID_ARGUMENT:case q.NOT_FOUND:case q.ALREADY_EXISTS:case q.PERMISSION_DENIED:case q.FAILED_PRECONDITION:case q.ABORTED:case q.OUT_OF_RANGE:case q.UNIMPLEMENTED:case q.DATA_LOSS:return!0}}function qn(t){if(void 0===t)return w("GRPC error has no .code"),q.UNKNOWN;switch(t){case Un.OK:return q.OK;case Un.CANCELLED:return q.CANCELLED;case Un.UNKNOWN:return q.UNKNOWN;case Un.DEADLINE_EXCEEDED:return q.DEADLINE_EXCEEDED;case Un.RESOURCE_EXHAUSTED:return q.RESOURCE_EXHAUSTED;case Un.INTERNAL:return q.INTERNAL;case Un.UNAVAILABLE:return q.UNAVAILABLE;case Un.UNAUTHENTICATED:return q.UNAUTHENTICATED;case Un.INVALID_ARGUMENT:return q.INVALID_ARGUMENT;case Un.NOT_FOUND:return q.NOT_FOUND;case Un.ALREADY_EXISTS:return q.ALREADY_EXISTS;case Un.PERMISSION_DENIED:return q.PERMISSION_DENIED;case Un.FAILED_PRECONDITION:return q.FAILED_PRECONDITION;case Un.ABORTED:return q.ABORTED;case Un.OUT_OF_RANGE:return q.OUT_OF_RANGE;case Un.UNIMPLEMENTED:return q.UNIMPLEMENTED;case Un.DATA_LOSS:return q.DATA_LOSS;default:return T()}}(jn=Un||(Un={}))[jn.OK=0]="OK",jn[jn.CANCELLED=1]="CANCELLED",jn[jn.UNKNOWN=2]="UNKNOWN",jn[jn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",jn[jn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",jn[jn.NOT_FOUND=5]="NOT_FOUND",jn[jn.ALREADY_EXISTS=6]="ALREADY_EXISTS",jn[jn.PERMISSION_DENIED=7]="PERMISSION_DENIED",jn[jn.UNAUTHENTICATED=16]="UNAUTHENTICATED",jn[jn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",jn[jn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",jn[jn.ABORTED=10]="ABORTED",jn[jn.OUT_OF_RANGE=11]="OUT_OF_RANGE",jn[jn.UNIMPLEMENTED=12]="UNIMPLEMENTED",jn[jn.INTERNAL=13]="INTERNAL",jn[jn.UNAVAILABLE=14]="UNAVAILABLE",jn[jn.DATA_LOSS=15]="DATA_LOSS";class $n{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return zn}static getOrCreateInstance(){return null===zn&&(zn=new $n),zn}onExistenceFilterMismatch(t){const e=Symbol();return this.onExistenceFilterMismatchCallbacks.set(e,t),()=>this.onExistenceFilterMismatchCallbacks.delete(e)}notifyOnExistenceFilterMismatch(t){this.onExistenceFilterMismatchCallbacks.forEach((e=>e(t)))}}let zn=null;function Kn(){return new TextEncoder}const li=new l.e([4294967295,4294967295],0);function Gn(t){const e=Kn().encode(t),n=new l.f;return n.update(e),new Uint8Array(n.digest())}function Hn(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),s=e.getUint32(4,!0),i=e.getUint32(8,!0),r=e.getUint32(12,!0);return[new l.e([n,s],0),new l.e([i,r],0)]}class Qn{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Wn(`Invalid padding: ${e}`);if(n<0)throw new Wn(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Wn(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Wn(`Invalid padding when bitmap length is 0: ${e}`);this.It=8*t.length-e,this.Tt=l.e.fromNumber(this.It)}Et(t,e,n){let s=t.add(e.multiply(l.e.fromNumber(n)));return 1===s.compare(li)&&(s=new l.e([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Tt).toNumber()}At(t){return 0!=(this.bitmap[Math.floor(t/8)]&1<<t%8)}vt(t){if(0===this.It)return!1;const e=Gn(t),[n,s]=Hn(e);for(let t=0;t<this.hashCount;t++){const e=this.Et(n,s,t);if(!this.At(e))return!1}return!0}static create(t,e,n){const s=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),r=new Qn(i,s,e);return n.forEach((t=>r.insert(t))),r}insert(t){if(0===this.It)return;const e=Gn(t),[n,s]=Hn(e);for(let t=0;t<this.hashCount;t++){const e=this.Et(n,s,t);this.Rt(e)}}Rt(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Wn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Yn{constructor(t,e,n,s,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const s=new Map;return s.set(t,Xn.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Yn(rt.min(),s,new gt(V),ze(),Ze())}}class Xn{constructor(t,e,n,s,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Xn(n,e,Ze(),Ze(),Ze())}}class Jn{constructor(t,e,n,s){this.Pt=t,this.removedTargetIds=e,this.key=n,this.bt=s}}class Zn{constructor(t,e){this.targetId=t,this.Vt=e}}class ti{constructor(t,e,n=It.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class ei{constructor(){this.St=0,this.Dt=ri(),this.Ct=It.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(t){t.approximateByteSize()>0&&(this.Nt=!0,this.Ct=t)}Ot(){let t=Ze(),e=Ze(),n=Ze();return this.Dt.forEach(((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:T()}})),new Xn(this.Ct,this.xt,t,e,n)}Ft(){this.Nt=!1,this.Dt=ri()}Bt(t,e){this.Nt=!0,this.Dt=this.Dt.insert(t,e)}Lt(t){this.Nt=!0,this.Dt=this.Dt.remove(t)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class ni{constructor(t){this.Gt=t,this.Qt=new Map,this.jt=ze(),this.zt=ii(),this.Wt=new gt(V)}Ht(t){for(const e of t.Pt)t.bt&&t.bt.isFoundDocument()?this.Jt(e,t.bt):this.Yt(e,t.key,t.bt);for(const e of t.removedTargetIds)this.Yt(e,t.key,t.bt)}Xt(t){this.forEachTarget(t,(e=>{const n=this.Zt(e);switch(t.state){case 0:this.te(e)&&n.$t(t.resumeToken);break;case 1:n.Ut(),n.kt||n.Ft(),n.$t(t.resumeToken);break;case 2:n.Ut(),n.kt||this.removeTarget(e);break;case 3:this.te(e)&&(n.Kt(),n.$t(t.resumeToken));break;case 4:this.te(e)&&(this.ee(e),n.$t(t.resumeToken));break;default:T()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Qt.forEach(((t,n)=>{this.te(n)&&e(n)}))}ne(t){var e;const n=t.targetId,s=t.Vt.count,i=this.se(n);if(i){const r=i.target;if(Te(r))if(0===s){const t=new G(r.path);this.Yt(n,t,Yt.newNoDocument(t,rt.min()))}else S(1===s);else{const i=this.ie(n);if(i!==s){const s=this.re(t,i);if(0!==s){this.ee(n);const t=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Wt=this.Wt.insert(n,t)}null===(e=$n.instance)||void 0===e||e.notifyOnExistenceFilterMismatch(function(t,e,n){var s,i,r,o,u,c;const a={localCacheCount:e,existenceFilterCount:n.count},h=n.unchangedNames;return h&&(a.bloomFilter={applied:0===t,hashCount:null!==(s=null==h?void 0:h.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(o=null===(r=null===(i=null==h?void 0:h.bits)||void 0===i?void 0:i.bitmap)||void 0===r?void 0:r.length)&&void 0!==o?o:0,padding:null!==(c=null===(u=null==h?void 0:h.bits)||void 0===u?void 0:u.padding)&&void 0!==c?c:0}),a}(s,i,t.Vt))}}}}re(t,e){const{unchangedNames:n,count:s}=t.Vt;if(!n||!n.bits)return 1;const{bits:{bitmap:i="",padding:r=0},hashCount:o=0}=n;let u,c;try{u=At(i).toUint8Array()}catch(t){if(t instanceof Et)return E("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw t}try{c=new Qn(u,r,o)}catch(t){return E(t instanceof Wn?"BloomFilter error: ":"Applying bloom filter failed: ",t),1}return 0===c.It?1:s!==e-this.oe(t.targetId,c)?2:0}oe(t,e){const n=this.Gt.getRemoteKeysForTarget(t);let s=0;return n.forEach((n=>{const i=this.Gt.ue(),r=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.vt(r)||(this.Yt(t,n,null),s++)})),s}ce(t){const e=new Map;this.Qt.forEach(((n,s)=>{const i=this.se(s);if(i){if(n.current&&Te(i.target)){const e=new G(i.target.path);null!==this.jt.get(e)||this.ae(s,e)||this.Yt(s,e,Yt.newNoDocument(e,t))}n.Mt&&(e.set(s,n.Ot()),n.Ft())}}));let n=Ze();this.zt.forEach(((t,e)=>{let s=!0;e.forEachWhile((t=>{const e=this.se(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(s=!1,!1)})),s&&(n=n.add(t))})),this.jt.forEach(((e,n)=>n.setReadTime(t)));const s=new Yn(t,e,this.Wt,this.jt,n);return this.jt=ze(),this.zt=ii(),this.Wt=new gt(V),s}Jt(t,e){if(!this.te(t))return;const n=this.ae(t,e.key)?2:0;this.Zt(t).Bt(e.key,n),this.jt=this.jt.insert(e.key,e),this.zt=this.zt.insert(e.key,this.he(e.key).add(t))}Yt(t,e,n){if(!this.te(t))return;const s=this.Zt(t);this.ae(t,e)?s.Bt(e,1):s.Lt(e),this.zt=this.zt.insert(e,this.he(e).delete(t)),n&&(this.jt=this.jt.insert(e,n))}removeTarget(t){this.Qt.delete(t)}ie(t){const e=this.Zt(t).Ot();return this.Gt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}qt(t){this.Zt(t).qt()}Zt(t){let e=this.Qt.get(t);return e||(e=new ei,this.Qt.set(t,e)),e}he(t){let e=this.zt.get(t);return e||(e=new vt(V),this.zt=this.zt.insert(t,e)),e}te(t){const e=null!==this.se(t);return e||v("WatchChangeAggregator","Detected inactive target",t),e}se(t){const e=this.Qt.get(t);return e&&e.kt?null:this.Gt.le(t)}ee(t){this.Qt.set(t,new ei),this.Gt.getRemoteKeysForTarget(t).forEach((e=>{this.Yt(t,e,null)}))}ae(t,e){return this.Gt.getRemoteKeysForTarget(t).has(e)}}function ii(){return new gt(G.comparator)}function ri(){return new gt(G.comparator)}const si={asc:"ASCENDING",desc:"DESCENDING"},oi={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ai={and:"AND",or:"OR"};class ci{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function ui(t,e){return t.useProto3Json||st(e)?e:{value:e}}function hi(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function di(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function fi(t,e){return hi(t,e.toTimestamp())}function pi(t){return S(!!t),rt.fromTimestamp(function(t){const e=St(t);return new j(e.seconds,e.nanos)}(t))}function gi(t,e){return function(t){return new $(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function mi(t){const e=$.fromString(t);return S(Li(e)),e}function yi(t,e){return gi(t.databaseId,e.path)}function vi(t,e){const n=mi(e);if(n.get(1)!==t.databaseId.projectId)throw new A(q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new A(q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new G(Ii(n))}function wi(t,e){return gi(t.databaseId,e)}function bi(t){const e=mi(t);return 4===e.length?$.emptyPath():Ii(e)}function Ei(t){return new $(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ii(t){return S(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Ti(t,e,n){return{name:yi(t,e),fields:n.value.mapValue.fields}}function Si(t,e){let n;if(e instanceof Dn)n={update:Ti(t,e.key,e.value)};else if(e instanceof Rn)n={delete:yi(t,e.key)};else if(e instanceof kn)n={update:Ti(t,e.key,e.data),updateMask:Mi(e.fieldMask)};else{if(!(e instanceof Mn))return T();n={verify:yi(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof hn)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ln)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof fn)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof gn)return{fieldPath:e.field.canonicalString(),increment:n.gt};throw T()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:fi(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:T()}(t,e.precondition)),n}function Ci(t,e){return{documents:[wi(t,e.path)]}}function Ai(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=wi(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=wi(t,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const i=function(t){if(0!==t.length)return Ri(re.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Oi(t.field),direction:tr(t.dir)}}(t)))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=ui(t,e.limit);var u;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(u=e.startAt).inclusive,values:u.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function _i(t){let e=bi(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){S(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function(t){const e=Di(t);return e instanceof re&&oe(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new te(xi(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let u=null;n.limit&&(u=function(t){let e;return e="object"==typeof t?t.value:t,st(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new Xt(n,e)}(n.startAt));let a=null;return n.endAt&&(a=function(t){const e=!t.before,n=t.values||[];return new Xt(n,e)}(n.endAt)),Ce(e,i,o,r,u,"F",c,a)}function Di(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=xi(t.unaryFilter.field);return ie.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=xi(t.unaryFilter.field);return ie.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=xi(t.unaryFilter.field);return ie.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=xi(t.unaryFilter.field);return ie.create(i,"!=",{nullValue:"NULL_VALUE"});default:return T()}}(t):void 0!==t.fieldFilter?function(t){return ie.create(xi(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return T()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return re.create(t.compositeFilter.filters.map((t=>Di(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return T()}}(t.compositeFilter.op))}(t):T()}function tr(t){return si[t]}function ki(t){return oi[t]}function Ni(t){return ai[t]}function Oi(t){return{fieldPath:t.canonicalString()}}function xi(t){return K.fromServerFormat(t.fieldPath)}function Ri(t){return t instanceof ie?function(t){if("=="===t.op){if(zt(t.value))return{unaryFilter:{field:Oi(t.field),op:"IS_NAN"}};if($t(t.value))return{unaryFilter:{field:Oi(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(zt(t.value))return{unaryFilter:{field:Oi(t.field),op:"IS_NOT_NAN"}};if($t(t.value))return{unaryFilter:{field:Oi(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Oi(t.field),op:ki(t.op),value:t.value}}}(t):t instanceof re?function(t){const e=t.getFilters().map((t=>Ri(t)));return 1===e.length?e[0]:{compositeFilter:{op:Ni(t.op),filters:e}}}(t):T()}function Mi(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Li(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Pi{constructor(t,e,n,s,i=rt.min(),r=rt.min(),o=It.EMPTY_BYTE_STRING,u=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o,this.expectedCount=u}withSequenceNumber(t){return new Pi(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Pi(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Pi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Pi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Fi{constructor(t){this.fe=t}}function Vi(t){const e=_i({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Me(e,e.limit,"L"):e}class br{constructor(){}_e(t,e){this.me(t,e),e.ge()}me(t,e){if("nullValue"in t)this.ye(e,5);else if("booleanValue"in t)this.ye(e,10),e.pe(t.booleanValue?1:0);else if("integerValue"in t)this.ye(e,15),e.pe(Ct(t.integerValue));else if("doubleValue"in t){const n=Ct(t.doubleValue);isNaN(n)?this.ye(e,13):(this.ye(e,15),ot(n)?e.pe(0):e.pe(n))}else if("timestampValue"in t){const n=t.timestampValue;this.ye(e,20),"string"==typeof n?e.Ie(n):(e.Ie(`${n.seconds||""}`),e.pe(n.nanos||0))}else if("stringValue"in t)this.Te(t.stringValue,e),this.Ee(e);else if("bytesValue"in t)this.ye(e,30),e.Ae(At(t.bytesValue)),this.Ee(e);else if("referenceValue"in t)this.ve(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.ye(e,45),e.pe(n.latitude||0),e.pe(n.longitude||0)}else"mapValue"in t?Ht(t)?this.ye(e,Number.MAX_SAFE_INTEGER):(this.Re(t.mapValue,e),this.Ee(e)):"arrayValue"in t?(this.Pe(t.arrayValue,e),this.Ee(e)):T()}Te(t,e){this.ye(e,25),this.be(t,e)}be(t,e){e.Ie(t)}Re(t,e){const n=t.fields||{};this.ye(e,55);for(const t of Object.keys(n))this.Te(t,e),this.me(n[t],e)}Pe(t,e){const n=t.values||[];this.ye(e,50);for(const t of n)this.me(t,e)}ve(t,e){this.ye(e,37),G.fromName(t).path.forEach((t=>{this.ye(e,60),this.be(t,e)}))}ye(t,e){t.pe(e)}Ee(t){t.pe(2)}}br.Ve=new br;class Ui{constructor(){this.rn=new ji}addToCollectionParentIndex(t,e){return this.rn.add(e),et.resolve()}getCollectionParents(t,e){return et.resolve(this.rn.getEntries(e))}addFieldIndex(t,e){return et.resolve()}deleteFieldIndex(t,e){return et.resolve()}getDocumentsMatchingTarget(t,e){return et.resolve(null)}getIndexType(t,e){return et.resolve(0)}getFieldIndexes(t,e){return et.resolve([])}getNextCollectionGroupToUpdate(t){return et.resolve(null)}getMinOffset(t,e){return et.resolve(Y.min())}getMinOffsetFromCollectionGroup(t,e){return et.resolve(Y.min())}updateCollectionGroup(t,e,n){return et.resolve()}updateIndexEntries(t,e){return et.resolve()}}class ji{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new vt($.comparator),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new vt($.comparator)).toArray()}}new Uint8Array(0);class Bi{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Bi(t,Bi.DEFAULT_COLLECTION_PERCENTILE,Bi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Bi.DEFAULT_COLLECTION_PERCENTILE=10,Bi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Bi.DEFAULT=new Bi(41943040,Bi.DEFAULT_COLLECTION_PERCENTILE,Bi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Bi.DISABLED=new Bi(-1,0,0);class qi{constructor(t){this.Nn=t}next(){return this.Nn+=2,this.Nn}static kn(){return new qi(0)}static Mn(){return new qi(-1)}}class $i{constructor(){this.changes=new qe((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Yt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?et.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class zi{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Ki{constructor(t,e,n,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=s}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(n=s,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Cn(n.mutation,t,bt.empty(),j.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,Ze()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=Ze()){const s=Qe();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,n).next((t=>{let e=Ge();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=Qe();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,Ze())))}populateOverlays(t,e,n){const s=[];return n.forEach((t=>{e.has(t)||s.push(t)})),this.documentOverlayCache.getOverlays(t,s).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,s){let i=ze();const r=Ye(),o=Ye();return e.forEach(((t,e)=>{const o=n.get(e.key);s.has(e.key)&&(void 0===o||o.mutation instanceof kn)?i=i.insert(e.key,e):void 0!==o?(r.set(e.key,o.mutation.getFieldMask()),Cn(o.mutation,e,o.mutation.getFieldMask(),j.now())):r.set(e.key,bt.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>r.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new zi(e,null!==(n=r.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=Ye();let s=new gt(((t,e)=>t-e)),i=Ze();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const r=e.get(t);if(null===r)return;let o=n.get(t)||bt.empty();o=i.applyToLocalView(r,o),n.set(t,o);const u=(s.get(i.batchId)||Ze()).add(t);s=s.insert(i.batchId,u)}))})).next((()=>{const r=[],o=s.getReverseIterator();for(;o.hasNext();){const s=o.getNext(),u=s.key,c=s.value,a=We();c.forEach((t=>{if(!i.has(t)){const s=Tn(e.get(t),n.get(t));null!==s&&a.set(t,s),i=i.add(t)}})),r.push(this.documentOverlayCache.saveOverlays(t,u,a))}return et.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return G.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Ne(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,s).next((i=>{const r=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,s-i.size):et.resolve(Qe());let o=-1,u=i;return r.next((e=>et.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?et.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{u=u.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,u,e,Ze()))).next((t=>({batchId:o,changes:He(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new G(e)).next((t=>{let e=Ge();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const s=e.collectionGroup;let i=Ge();return this.indexManager.getCollectionParents(t,s).next((r=>et.forEach(r,(r=>{const o=function(t,e){return new Se(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,r.child(s));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,e,n){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s)))).next((t=>{s.forEach(((e,n)=>{const s=n.getKey();null===t.get(s)&&(t=t.insert(s,Yt.newInvalidDocument(s)))}));let n=Ge();return t.forEach(((t,i)=>{const r=s.get(t);void 0!==r&&Cn(r.mutation,i,bt.empty(),j.now()),Ve(e,i)&&(n=n.insert(t,i))})),n}))}}class Gi{constructor(t){this.serializer=t,this.cs=new Map,this.hs=new Map}getBundleMetadata(t,e){return et.resolve(this.cs.get(e))}saveBundleMetadata(t,e){var n;return this.cs.set(e.id,{id:(n=e).id,version:n.version,createTime:pi(n.createTime)}),et.resolve()}getNamedQuery(t,e){return et.resolve(this.hs.get(e))}saveNamedQuery(t,e){return this.hs.set(e.name,function(t){return{name:t.name,query:Vi(t.bundledQuery),readTime:pi(t.readTime)}}(e)),et.resolve()}}class Hi{constructor(){this.overlays=new gt(G.comparator),this.ls=new Map}getOverlay(t,e){return et.resolve(this.overlays.get(e))}getOverlays(t,e){const n=Qe();return et.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,s)=>{this.we(t,e,s)})),et.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.ls.get(n);return void 0!==s&&(s.forEach((t=>this.overlays=this.overlays.remove(t))),this.ls.delete(n)),et.resolve()}getOverlaysForCollection(t,e,n){const s=Qe(),i=e.length+1,r=new G(e.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const t=o.getNext().value,r=t.getKey();if(!e.isPrefixOf(r.path))break;r.path.length===i&&t.largestBatchId>n&&s.set(t.getKey(),t)}return et.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let i=new gt(((t,e)=>t-e));const r=this.overlays.getIterator();for(;r.hasNext();){const t=r.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=Qe(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=Qe(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=s)););return et.resolve(o)}we(t,e,n){const s=this.overlays.get(n.key);if(null!==s){const t=this.ls.get(s.largestBatchId).delete(n.key);this.ls.set(s.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Fn(e,n));let i=this.ls.get(e);void 0===i&&(i=Ze(),this.ls.set(e,i)),this.ls.set(e,i.add(n.key))}}class Qi{constructor(){this.fs=new vt(Wi.ds),this.ws=new vt(Wi._s)}isEmpty(){return this.fs.isEmpty()}addReference(t,e){const n=new Wi(t,e);this.fs=this.fs.add(n),this.ws=this.ws.add(n)}gs(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.ys(new Wi(t,e))}ps(t,e){t.forEach((t=>this.removeReference(t,e)))}Is(t){const e=new G(new $([])),n=new Wi(e,t),s=new Wi(e,t+1),i=[];return this.ws.forEachInRange([n,s],(t=>{this.ys(t),i.push(t.key)})),i}Ts(){this.fs.forEach((t=>this.ys(t)))}ys(t){this.fs=this.fs.delete(t),this.ws=this.ws.delete(t)}Es(t){const e=new G(new $([])),n=new Wi(e,t),s=new Wi(e,t+1);let i=Ze();return this.ws.forEachInRange([n,s],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new Wi(t,0),n=this.fs.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Wi{constructor(t,e){this.key=t,this.As=e}static ds(t,e){return G.comparator(t.key,e.key)||V(t.As,e.As)}static _s(t,e){return V(t.As,e.As)||G.comparator(t.key,e.key)}}class Yi{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.vs=1,this.Rs=new vt(Wi.ds)}checkEmpty(t){return et.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,s){const i=this.vs;this.vs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new Ln(i,e,n,s);this.mutationQueue.push(r);for(const e of s)this.Rs=this.Rs.add(new Wi(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return et.resolve(r)}lookupMutationBatch(t,e){return et.resolve(this.Ps(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.bs(n),i=s<0?0:s;return et.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return et.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(t){return et.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Wi(e,0),s=new Wi(e,Number.POSITIVE_INFINITY),i=[];return this.Rs.forEachInRange([n,s],(t=>{const e=this.Ps(t.As);i.push(e)})),et.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new vt(V);return e.forEach((t=>{const e=new Wi(t,0),s=new Wi(t,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([e,s],(t=>{n=n.add(t.As)}))})),et.resolve(this.Vs(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let i=n;G.isDocumentKey(i)||(i=i.child(""));const r=new Wi(new G(i),0);let o=new vt(V);return this.Rs.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.As)),!0)}),r),et.resolve(this.Vs(o))}Vs(t){const e=[];return t.forEach((t=>{const n=this.Ps(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){S(0===this.Ss(e.batchId,"removed")),this.mutationQueue.shift();let n=this.Rs;return et.forEach(e.mutations,(s=>{const i=new Wi(s.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Rs=n}))}Cn(t){}containsKey(t,e){const n=new Wi(e,0),s=this.Rs.firstAfterOrEqual(n);return et.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,et.resolve()}Ss(t,e){return this.bs(t)}bs(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Ps(t){const e=this.bs(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Xi{constructor(t){this.Ds=t,this.docs=new gt(G.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),i=s?s.size:0,r=this.Ds(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:r}),this.size+=r-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return et.resolve(n?n.document.mutableCopy():Yt.newInvalidDocument(e))}getEntries(t,e){let n=ze();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Yt.newInvalidDocument(t))})),et.resolve(n)}getDocumentsMatchingQuery(t,e,n,s){let i=ze();const r=e.path,o=new G(r.child("")),u=this.docs.getIteratorFrom(o);for(;u.hasNext();){const{key:t,value:{document:o}}=u.getNext();if(!r.isPrefixOf(t.path))break;t.path.length>r.length+1||X(W(o),n)<=0||(s.has(o.key)||Ve(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return et.resolve(i)}getAllFromCollectionGroup(t,e,n,s){T()}Cs(t,e){return et.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Ji(this)}getSize(t){return et.resolve(this.size)}}class Ji extends $i{constructor(t){super(),this.os=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.os.addEntry(t,s)):this.os.removeEntry(n)})),et.waitFor(e)}getFromCache(t,e){return this.os.getEntry(t,e)}getAllFromCache(t,e){return this.os.getEntries(t,e)}}class Zi{constructor(t){this.persistence=t,this.xs=new qe((t=>Ee(t)),Ie),this.lastRemoteSnapshotVersion=rt.min(),this.highestTargetId=0,this.Ns=0,this.ks=new Qi,this.targetCount=0,this.Ms=qi.kn()}forEachTarget(t,e){return this.xs.forEach(((t,n)=>e(n))),et.resolve()}getLastRemoteSnapshotVersion(t){return et.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return et.resolve(this.Ns)}allocateTargetId(t){return this.highestTargetId=this.Ms.next(),et.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ns&&(this.Ns=e),et.resolve()}Fn(t){this.xs.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Ms=new qi(e),this.highestTargetId=e),t.sequenceNumber>this.Ns&&(this.Ns=t.sequenceNumber)}addTargetData(t,e){return this.Fn(e),this.targetCount+=1,et.resolve()}updateTargetData(t,e){return this.Fn(e),et.resolve()}removeTargetData(t,e){return this.xs.delete(e.target),this.ks.Is(e.targetId),this.targetCount-=1,et.resolve()}removeTargets(t,e,n){let s=0;const i=[];return this.xs.forEach(((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.xs.delete(r),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),s++)})),et.waitFor(i).next((()=>s))}getTargetCount(t){return et.resolve(this.targetCount)}getTargetData(t,e){const n=this.xs.get(e)||null;return et.resolve(n)}addMatchingKeys(t,e,n){return this.ks.gs(e,n),et.resolve()}removeMatchingKeys(t,e,n){this.ks.ps(e,n);const s=this.persistence.referenceDelegate,i=[];return s&&e.forEach((e=>{i.push(s.markPotentiallyOrphaned(t,e))})),et.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.ks.Is(e),et.resolve()}getMatchingKeysForTargetId(t,e){const n=this.ks.Es(e);return et.resolve(n)}containsKey(t,e){return et.resolve(this.ks.containsKey(e))}}class er{constructor(t,e){this.$s={},this.overlays={},this.Os=new it(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=t(this),this.Bs=new Zi(this),this.indexManager=new Ui,this.remoteDocumentCache=function(t){return new Xi(t)}((t=>this.referenceDelegate.Ls(t))),this.serializer=new Fi(e),this.qs=new Gi(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Hi,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.$s[t.toKey()];return n||(n=new Yi(e,this.referenceDelegate),this.$s[t.toKey()]=n),n}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(t,e,n){v("MemoryPersistence","Starting transaction:",t);const s=new nr(this.Os.next());return this.referenceDelegate.Us(),n(s).next((t=>this.referenceDelegate.Ks(s).next((()=>t)))).toPromise().then((t=>(s.raiseOnCommittedEvent(),t)))}Gs(t,e){return et.or(Object.values(this.$s).map((n=>()=>n.containsKey(t,e))))}}class nr extends Z{constructor(t){super(),this.currentSequenceNumber=t}}class ir{constructor(t){this.persistence=t,this.Qs=new Qi,this.js=null}static zs(t){return new ir(t)}get Ws(){if(this.js)return this.js;throw T()}addReference(t,e,n){return this.Qs.addReference(n,e),this.Ws.delete(n.toString()),et.resolve()}removeReference(t,e,n){return this.Qs.removeReference(n,e),this.Ws.add(n.toString()),et.resolve()}markPotentiallyOrphaned(t,e){return this.Ws.add(e.toString()),et.resolve()}removeTarget(t,e){this.Qs.Is(e.targetId).forEach((t=>this.Ws.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Ws.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Us(){this.js=new Set}Ks(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return et.forEach(this.Ws,(n=>{const s=G.fromPath(n);return this.Hs(t,s).next((t=>{t||e.removeEntry(s,rt.min())}))})).next((()=>(this.js=null,e.apply(t))))}updateLimboDocument(t,e){return this.Hs(t,e).next((t=>{t?this.Ws.delete(e.toString()):this.Ws.add(e.toString())}))}Ls(t){return 0}Hs(t,e){return et.or([()=>et.resolve(this.Qs.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gs(t,e)])}}class rr{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Fi=n,this.Bi=s}static Li(t,e){let n=Ze(),s=Ze();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new rr(t,e.fromCache,n,s)}}class sr{constructor(){this.qi=!1}initialize(t,e){this.Ui=t,this.indexManager=e,this.qi=!0}getDocumentsMatchingQuery(t,e,n,s){return this.Ki(t,e).next((i=>i||this.Gi(t,e,s,n))).next((n=>n||this.Qi(t,e)))}Ki(t,e){if(_e(e))return et.resolve(null);let n=xe(e);return this.indexManager.getIndexType(t,n).next((s=>0===s?null:(null!==e.limit&&1===s&&(e=Me(e,null,"F"),n=xe(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((s=>{const i=Ze(...s);return this.Ui.getDocuments(t,i).next((s=>this.indexManager.getMinOffset(t,n).next((n=>{const r=this.ji(e,s);return this.zi(e,r,i,n.readTime)?this.Ki(t,Me(e,null,"F")):this.Wi(t,r,e,n)}))))})))))}Gi(t,e,n,s){return _e(e)||s.isEqual(rt.min())?this.Qi(t,e):this.Ui.getDocuments(t,n).next((i=>{const r=this.ji(e,i);return this.zi(e,r,n,s)?this.Qi(t,e):(y()<=c.a.DEBUG&&v("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Fe(e)),this.Wi(t,r,e,Q(s,-1)))}))}ji(t,e){let n=new vt(je(t));return e.forEach(((e,s)=>{Ve(t,s)&&(n=n.add(s))})),n}zi(t,e,n,s){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Qi(t,e){return y()<=c.a.DEBUG&&v("QueryEngine","Using full collection scan to execute query:",Fe(e)),this.Ui.getDocumentsMatchingQuery(t,e,Y.min())}Wi(t,e,n,s){return this.Ui.getDocumentsMatchingQuery(t,n,s).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class or{constructor(t,e,n,s){this.persistence=t,this.Hi=e,this.serializer=s,this.Ji=new gt(V),this.Yi=new qe((t=>Ee(t)),Ie),this.Xi=new Map,this.Zi=t.getRemoteDocumentCache(),this.Bs=t.getTargetCache(),this.qs=t.getBundleCache(),this.tr(n)}tr(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Ki(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ji)))}}function ar(t,e,n,s){return new or(t,e,n,s)}async function cr(t,e){const n=C(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let s;return n.mutationQueue.getAllMutationBatches(t).next((i=>(s=i,n.tr(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],r=[];let o=Ze();for(const t of s){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({er:t,removedBatchIds:i,addedBatchIds:r})))}))}))}function ur(t){const e=C(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Bs.getLastRemoteSnapshotVersion(t)))}function lr(t,e,n){let s=Ze(),i=Ze();return n.forEach((t=>s=s.add(t))),e.getEntries(t,s).next((t=>{let s=ze();return n.forEach(((n,r)=>{const o=t.get(n);r.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),r.isNoDocument()&&r.version.isEqual(rt.min())?(e.removeEntry(n,r.readTime),s=s.insert(n,r)):!o.isValidDocument()||r.version.compareTo(o.version)>0||0===r.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(r),s=s.insert(n,r)):v("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)})),{nr:s,sr:i}}))}function dr(t,e){const n=C(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}function fr(t,e){const n=C(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let s;return n.Bs.getTargetData(t,e).next((i=>i?(s=i,et.resolve(s)):n.Bs.allocateTargetId(t).next((i=>(s=new Pi(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.Bs.addTargetData(t,s).next((()=>s)))))))})).then((t=>{const s=n.Ji.get(t.targetId);return(null===s||t.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(t.targetId,t),n.Yi.set(e,t.targetId)),t}))}async function pr(t,e,n){const s=C(t),i=s.Ji.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,(t=>s.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!nt(t))throw t;v("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.Ji=s.Ji.remove(e),s.Yi.delete(i.target)}function gr(t,e,n){const s=C(t);let i=rt.min(),r=Ze();return s.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const s=C(t),i=s.Yi.get(n);return void 0!==i?et.resolve(s.Ji.get(i)):s.Bs.getTargetData(e,n)}(s,t,xe(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.Bs.getMatchingKeysForTargetId(t,e.targetId).next((t=>{r=t}))})).next((()=>s.Hi.getDocumentsMatchingQuery(t,e,n?i:rt.min(),n?r:Ze()))).next((t=>(mr(s,Ue(e),t),{documents:t,ir:r})))))}function mr(t,e,n){let s=t.Xi.get(e)||rt.min();n.forEach(((t,e)=>{e.readTime.compareTo(s)>0&&(s=e.readTime)})),t.Xi.set(e,s)}class yr{constructor(){this.activeTargetIds=en()}lr(t){this.activeTargetIds=this.activeTargetIds.add(t)}dr(t){this.activeTargetIds=this.activeTargetIds.delete(t)}hr(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class vr{constructor(){this.Hr=new yr,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Hr.lr(t),this.Jr[t]||"not-current"}updateQueryState(t,e,n){this.Jr[t]=e}removeLocalQueryTarget(t){this.Hr.dr(t)}isLocalQueryTarget(t){return this.Hr.activeTargetIds.has(t)}clearQueryState(t){delete this.Jr[t]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(t){return this.Hr.activeTargetIds.has(t)}start(){return this.Hr=new yr,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class wr{Yr(t){}shutdown(){}}class Er{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(t){this.so.push(t)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.so)t(0)}no(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.so)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Ir=null;function Tr(){return null===Ir?Ir=268435456+Math.round(2147483648*Math.random()):Ir++,"0x"+Ir.toString(16)}const Sr={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Cr{constructor(t){this.ro=t.ro,this.oo=t.oo}uo(t){this.co=t}ao(t){this.ho=t}onMessage(t){this.lo=t}close(){this.oo()}send(t){this.ro(t)}fo(){this.co()}wo(t){this.ho(t)}_o(t){this.lo(t)}}const Ar="WebChannelConnection";class _r extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.mo=e+"://"+t.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(t,e,n,s,i){const r=Tr(),o=this.To(t,e);v("RestConnection",`Sending RPC '${t}' ${r}:`,o,n);const u={};return this.Eo(u,s,i),this.Ao(t,o,u,n).then((e=>(v("RestConnection",`Received RPC '${t}' ${r}: `,e),e)),(e=>{throw E("RestConnection",`RPC '${t}' ${r} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,s,i,r){return this.Io(t,e,n,s,i)}Eo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+f,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}To(t,e){const n=Sr[t];return`${this.mo}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Ao(t,e,n,s){const i=Tr();return new Promise(((r,o)=>{const u=new l.i;u.setWithCredentials(!0),u.listenOnce(l.c.COMPLETE,(()=>{try{switch(u.getLastErrorCode()){case l.a.NO_ERROR:const e=u.getResponseJson();v(Ar,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(e)),r(e);break;case l.a.TIMEOUT:v(Ar,`RPC '${t}' ${i} timed out`),o(new A(q.DEADLINE_EXCEEDED,"Request time out"));break;case l.a.HTTP_ERROR:const n=u.getStatus();if(v(Ar,`RPC '${t}' ${i} failed with status:`,n,"response text:",u.getResponseText()),n>0){let t=u.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(q).indexOf(e)>=0?e:q.UNKNOWN}(e.status);o(new A(t,e.message))}else o(new A(q.UNKNOWN,"Server responded with status "+u.getStatus()))}else o(new A(q.UNAVAILABLE,"Connection failed."));break;default:T()}}finally{v(Ar,`RPC '${t}' ${i} completed.`)}}));const c=JSON.stringify(s);v(Ar,`RPC '${t}' ${i} sending request:`,s),u.send(e,"POST",c,n,15)}))}Ro(t,e,n){const s=Tr(),i=[this.mo,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=Object(l.j)(),o=Object(l.k)(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new l.d({})),this.Eo(u.initMessageHeaders,e,n),u.encodeInitMessageHeaders=!0;const a=i.join("");v(Ar,`Creating RPC '${t}' stream ${s}: ${a}`,u);const h=r.createWebChannel(a,u);let d=!1,f=!1;const m=new Cr({ro:e=>{f?v(Ar,`Not sending because RPC '${t}' stream ${s} is closed:`,e):(d||(v(Ar,`Opening RPC '${t}' stream ${s} transport.`),h.open(),d=!0),v(Ar,`RPC '${t}' stream ${s} sending:`,e),h.send(e))},oo:()=>h.close()}),y=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return y(h,l.h.EventType.OPEN,(()=>{f||v(Ar,`RPC '${t}' stream ${s} transport opened.`)})),y(h,l.h.EventType.CLOSE,(()=>{f||(f=!0,v(Ar,`RPC '${t}' stream ${s} transport closed`),m.wo())})),y(h,l.h.EventType.ERROR,(e=>{f||(f=!0,E(Ar,`RPC '${t}' stream ${s} transport errored:`,e),m.wo(new A(q.UNAVAILABLE,"The operation could not be completed")))})),y(h,l.h.EventType.MESSAGE,(e=>{var n;if(!f){const i=e.data[0];S(!!i);const r=i,o=r.error||(null===(n=r[0])||void 0===n?void 0:n.error);if(o){v(Ar,`RPC '${t}' stream ${s} received error:`,o);const e=o.status;let n=function(t){const e=Un[t];if(void 0!==e)return qn(e)}(e),i=o.message;void 0===n&&(n=q.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),f=!0,m.wo(new A(n,i)),h.close()}else v(Ar,`RPC '${t}' stream ${s} received:`,i),m._o(i)}})),y(o,l.b.STAT_EVENT,(e=>{e.stat===l.g.PROXY?v(Ar,`RPC '${t}' stream ${s} detected buffering proxy`):e.stat===l.g.NOPROXY&&v(Ar,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{m.fo()}),0),m}}function Dr(){return"undefined"!=typeof document?document:null}function kr(t){return new ci(t,!0)}class Nr{constructor(t,e,n=1e3,s=1.5,i=6e4){this.ii=t,this.timerId=e,this.Po=n,this.bo=s,this.Vo=i,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(t){this.cancel();const e=Math.floor(this.So+this.ko()),n=Math.max(0,Date.now()-this.Co),s=Math.max(0,e-n);s>0&&v("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.So} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,s,(()=>(this.Co=Date.now(),t()))),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class Or{constructor(t,e,n,s,i,r,o,u){this.ii=t,this.$o=n,this.Oo=s,this.connection=i,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=u,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new Nr(t,e)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}async stop(){this.Uo()&&await this.close(0)}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,(()=>this.zo())))}Wo(t){this.Ho(),this.stream.send(t)}async zo(){if(this.Ko())return this.close(0)}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}async close(t,e){this.Ho(),this.Jo(),this.qo.cancel(),this.Fo++,4!==t?this.qo.reset():e&&e.code===q.RESOURCE_EXHAUSTED?(w(e.toString()),w("Using maximum backoff delay to prevent overloading the backend."),this.qo.xo()):e&&e.code===q.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Yo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.ao(e)}Yo(){}auth(){this.state=1;const t=this.Xo(this.Fo),e=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Fo===e&&this.Zo(t,n)}),(e=>{t((()=>{const t=new A(q.UNKNOWN,"Fetching auth token failed: "+e.message);return this.tu(t)}))}))}Zo(t,e){const n=this.Xo(this.Fo);this.stream=this.eu(t,e),this.stream.uo((()=>{n((()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,(()=>(this.Ko()&&(this.state=3),Promise.resolve()))),this.listener.uo())))})),this.stream.ao((t=>{n((()=>this.tu(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Go(){this.state=5,this.qo.No((async()=>{this.state=0,this.start()}))}tu(t){return v("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Xo(t){return e=>{this.ii.enqueueAndForget((()=>this.Fo===t?e():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class xr extends Or{constructor(t,e,n,s,i,r){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,r),this.serializer=i}eu(t,e){return this.connection.Ro("Listen",t,e)}onMessage(t){this.qo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:T()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.useProto3Json?(S(void 0===e||"string"==typeof e),It.fromBase64String(e||"")):(S(void 0===e||e instanceof Uint8Array),It.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,u=o&&function(t){const e=void 0===t.code?q.UNKNOWN:qn(t.code);return new A(e,t.message||"")}(o);n=new ti(s,i,r,u||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=vi(t,s.document.name),r=pi(s.document.updateTime),o=s.document.createTime?pi(s.document.createTime):rt.min(),u=new Qt({mapValue:{fields:s.document.fields}}),c=Yt.newFoundDocument(i,r,o,u),a=s.targetIds||[],h=s.removedTargetIds||[];n=new Jn(a,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=vi(t,s.document),r=s.readTime?pi(s.readTime):rt.min(),o=Yt.newNoDocument(i,r),u=s.removedTargetIds||[];n=new Jn([],u,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=vi(t,s.document),r=s.removedTargetIds||[];n=new Jn([],r,i,null)}else{if(!("filter"in e))return T();{e.filter;const t=e.filter;t.targetId;const{count:s=0,unchangedNames:i}=t,r=new Vn(s,i),o=t.targetId;n=new Zn(o,r)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return rt.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?rt.min():e.readTime?pi(e.readTime):rt.min()}(t);return this.listener.nu(e,n)}su(t){const e={};e.database=Ei(this.serializer),e.addTarget=function(t,e){let n;const s=e.target;if(n=Te(s)?{documents:Ci(t,s)}:{query:Ai(t,s)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=di(t,e.resumeToken);const s=ui(t,e.expectedCount);null!==s&&(n.expectedCount=s)}else if(e.snapshotVersion.compareTo(rt.min())>0){n.readTime=hi(t,e.snapshotVersion.toTimestamp());const s=ui(t,e.expectedCount);null!==s&&(n.expectedCount=s)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return T()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Wo(e)}iu(t){const e={};e.database=Ei(this.serializer),e.removeTarget=t,this.Wo(e)}}class Rr extends Or{constructor(t,e,n,s,i,r){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,r),this.serializer=i,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(t,e){return this.connection.Ro("Write",t,e)}onMessage(t){if(S(!!t.streamToken),this.lastStreamToken=t.streamToken,this.ru){this.qo.reset();const e=function(t,e){return t&&t.length>0?(S(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?pi(t.updateTime):pi(e);return n.isEqual(rt.min())&&(n=pi(e)),new wn(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=pi(t.commitTime);return this.listener.cu(n,e)}return S(!t.writeResults||0===t.writeResults.length),this.ru=!0,this.listener.au()}hu(){const t={};t.database=Ei(this.serializer),this.Wo(t)}uu(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>Si(this.serializer,t)))};this.Wo(e)}}class Mr extends class{}{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=s,this.lu=!1}fu(){if(this.lu)throw new A(q.FAILED_PRECONDITION,"The client has already been terminated.")}Io(t,e,n){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.Io(t,e,n,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new A(q.UNKNOWN,t.toString())}))}vo(t,e,n,s){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.connection.vo(t,e,n,i,r,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new A(q.UNKNOWN,t.toString())}))}terminate(){this.lu=!0}}class Lr{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve()))))}Iu(t){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.yu("Offline")))}set(t){this.Tu(),this.wu=0,"Online"===t&&(this.mu=!1),this.yu(t)}yu(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}pu(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(w(e),this.mu=!1):v("OnlineStateTracker",e)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class Pr{constructor(t,e,n,s,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=i,this.Pu.Yr((t=>{n.enqueueAndForget((async()=>{Kr(this)&&(v("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=C(t);e.vu.add(4),await Vr(e),e.bu.set("Unknown"),e.vu.delete(4),await Fr(e)}(this))}))})),this.bu=new Lr(n,s)}}async function Fr(t){if(Kr(t))for(const e of t.Ru)await e(!0)}async function Vr(t){for(const e of t.Ru)await e(!1)}function Ur(t,e){const n=C(t);n.Au.has(e.targetId)||(n.Au.set(e.targetId,e),zr(n)?$r(n):us(n).Ko()&&Br(n,e))}function jr(t,e){const n=C(t),s=us(n);n.Au.delete(e),s.Ko()&&qr(n,e),0===n.Au.size&&(s.Ko()?s.jo():Kr(n)&&n.bu.set("Unknown"))}function Br(t,e){if(t.Vu.qt(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(rt.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}us(t).su(e)}function qr(t,e){t.Vu.qt(e),us(t).iu(e)}function $r(t){t.Vu=new ni({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),le:e=>t.Au.get(e)||null,ue:()=>t.datastore.serializer.databaseId}),us(t).start(),t.bu.gu()}function zr(t){return Kr(t)&&!us(t).Uo()&&t.Au.size>0}function Kr(t){return 0===C(t).vu.size}function Gr(t){t.Vu=void 0}async function Hr(t){t.Au.forEach(((e,n)=>{Br(t,e)}))}async function Qr(t,e){Gr(t),zr(t)?(t.bu.Iu(e),$r(t)):t.bu.set("Unknown")}async function Wr(t,e,n){if(t.bu.set("Online"),e instanceof ti&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.Au.has(s)&&(await t.remoteSyncer.rejectListen(s,n),t.Au.delete(s),t.Vu.removeTarget(s))}(t,e)}catch(n){v("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Yr(t,n)}else if(e instanceof Jn?t.Vu.Ht(e):e instanceof Zn?t.Vu.ne(e):t.Vu.Xt(e),!n.isEqual(rt.min()))try{const e=await ur(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Vu.ce(e);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.Au.get(s);i&&t.Au.set(s,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const s=t.Au.get(e);if(!s)return;t.Au.set(e,s.withResumeToken(It.EMPTY_BYTE_STRING,s.snapshotVersion)),qr(t,e);const i=new Pi(s.target,e,n,s.sequenceNumber);Br(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){v("RemoteStore","Failed to raise snapshot:",e),await Yr(t,e)}}async function Yr(t,e,n){if(!nt(e))throw e;t.vu.add(1),await Vr(t),t.bu.set("Offline"),n||(n=()=>ur(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{v("RemoteStore","Retrying IndexedDB access"),await n(),t.vu.delete(1),await Fr(t)}))}function Xr(t,e){return e().catch((n=>Yr(t,n,e)))}async function Jr(t){const e=C(t),n=hs(e);let s=e.Eu.length>0?e.Eu[e.Eu.length-1].batchId:-1;for(;Zr(e);)try{const t=await dr(e.localStore,s);if(null===t){0===e.Eu.length&&n.jo();break}s=t.batchId,ts(e,t)}catch(t){await Yr(e,t)}es(e)&&ns(e)}function Zr(t){return Kr(t)&&t.Eu.length<10}function ts(t,e){t.Eu.push(e);const n=hs(t);n.Ko()&&n.ou&&n.uu(e.mutations)}function es(t){return Kr(t)&&!hs(t).Uo()&&t.Eu.length>0}function ns(t){hs(t).start()}async function is(t){hs(t).hu()}async function rs(t){const e=hs(t);for(const n of t.Eu)e.uu(n.mutations)}async function ss(t,e,n){const s=t.Eu.shift(),i=Pn.from(s,e,n);await Xr(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await Jr(t)}async function os(t,e){e&&hs(t).ou&&await async function(t,e){if(Bn(n=e.code)&&n!==q.ABORTED){const n=t.Eu.shift();hs(t).Qo(),await Xr(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Jr(t)}var n}(t,e),es(t)&&ns(t)}async function as(t,e){const n=C(t);n.asyncQueue.verifyOperationInProgress(),v("RemoteStore","RemoteStore received new credentials");const s=Kr(n);n.vu.add(3),await Vr(n),s&&n.bu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.vu.delete(3),await Fr(n)}async function cs(t,e){const n=C(t);e?(n.vu.delete(2),await Fr(n)):e||(n.vu.add(2),await Vr(n),n.bu.set("Unknown"))}function us(t){return t.Su||(t.Su=function(t,e,n){const s=C(t);return s.fu(),new xr(e,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(t.datastore,t.asyncQueue,{uo:Hr.bind(null,t),ao:Qr.bind(null,t),nu:Wr.bind(null,t)}),t.Ru.push((async e=>{e?(t.Su.Qo(),zr(t)?$r(t):t.bu.set("Unknown")):(await t.Su.stop(),Gr(t))}))),t.Su}function hs(t){return t.Du||(t.Du=function(t,e,n){const s=C(t);return s.fu(),new Rr(e,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,n)}(t.datastore,t.asyncQueue,{uo:is.bind(null,t),ao:os.bind(null,t),au:rs.bind(null,t),cu:ss.bind(null,t)}),t.Ru.push((async e=>{e?(t.Du.Qo(),await Jr(t)):(await t.Du.stop(),t.Eu.length>0&&(v("RemoteStore",`Stopping write stream with ${t.Eu.length} pending writes`),t.Eu=[]))}))),t.Du}class ls{constructor(t,e,n,s,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new _,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,s,i){const r=Date.now()+n,o=new ls(t,e,r,s,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new A(q.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ds(t,e){if(w("AsyncQueue",`${e}: ${t}`),nt(t))return new A(q.UNAVAILABLE,`${e}: ${t}`);throw t}class fs{constructor(t){this.comparator=t?(e,n)=>t(e,n)||G.comparator(e.key,n.key):(t,e)=>G.comparator(t.key,e.key),this.keyedMap=Ge(),this.sortedSet=new gt(this.comparator)}static emptySet(t){return new fs(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof fs))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new fs;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class ps{constructor(){this.Cu=new gt(G.comparator)}track(t){const e=t.doc.key,n=this.Cu.get(e);n?0!==t.type&&3===n.type?this.Cu=this.Cu.insert(e,t):3===t.type&&1!==n.type?this.Cu=this.Cu.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Cu=this.Cu.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Cu=this.Cu.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Cu=this.Cu.remove(e):1===t.type&&2===n.type?this.Cu=this.Cu.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Cu=this.Cu.insert(e,{type:2,doc:t.doc}):T():this.Cu=this.Cu.insert(e,t)}xu(){const t=[];return this.Cu.inorderTraversal(((e,n)=>{t.push(n)})),t}}class gs{constructor(t,e,n,s,i,r,o,u,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,s,i){const r=[];return e.forEach((t=>{r.push({type:0,doc:t})})),new gs(t,e,fs.emptySet(e),r,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Le(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class ms{constructor(){this.Nu=void 0,this.listeners=[]}}class ys{constructor(){this.queries=new qe((t=>Pe(t)),Le),this.onlineState="Unknown",this.ku=new Set}}async function vs(t,e){const n=C(t),s=e.query;let i=!1,r=n.queries.get(s);if(r||(i=!0,r=new ms),i)try{r.Nu=await n.onListen(s)}catch(t){const n=ds(t,`Initialization of query '${Fe(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,r),r.listeners.push(e),e.Mu(n.onlineState),r.Nu&&e.$u(r.Nu)&&Is(n)}async function ws(t,e){const n=C(t),s=e.query;let i=!1;const r=n.queries.get(s);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return n.queries.delete(s),n.onUnlisten(s)}function bs(t,e){const n=C(t);let s=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.$u(t)&&(s=!0);i.Nu=t}}s&&Is(n)}function Es(t,e,n){const s=C(t),i=s.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);s.queries.delete(e)}function Is(t){t.ku.forEach((t=>{t.next()}))}class Ts{constructor(t,e,n){this.query=t,this.Ou=e,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=n||{}}$u(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new gs(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Fu?this.Lu(t)&&(this.Ou.next(t),e=!0):this.qu(t,this.onlineState)&&(this.Uu(t),e=!0),this.Bu=t,e}onError(t){this.Ou.error(t)}Mu(t){this.onlineState=t;let e=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,t)&&(this.Uu(this.Bu),e=!0),e}qu(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Ku||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Lu(t){if(t.docChanges.length>0)return!0;const e=this.Bu&&this.Bu.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Uu(t){t=gs.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Fu=!0,this.Ou.next(t)}}class Ss{constructor(t){this.key=t}}class Cs{constructor(t){this.key=t}}class As{constructor(t,e){this.query=t,this.Yu=e,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=Ze(),this.mutatedKeys=Ze(),this.tc=je(t),this.ec=new fs(this.tc)}get nc(){return this.Yu}sc(t,e){const n=e?e.ic:new ps,s=e?e.ec:this.ec;let i=e?e.mutatedKeys:this.mutatedKeys,r=s,o=!1;const u="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((t,e)=>{const a=s.get(t),h=Ve(this.query,e)?e:null,l=!!a&&this.mutatedKeys.has(a.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;a&&h?a.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.rc(a,h)||(n.track({type:2,doc:h}),f=!0,(u&&this.tc(h,u)>0||c&&this.tc(h,c)<0)&&(o=!0)):!a&&h?(n.track({type:0,doc:h}),f=!0):a&&!h&&(n.track({type:1,doc:a}),f=!0,(u||c)&&(o=!0)),f&&(h?(r=r.add(h),i=d?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const t="F"===this.query.limitType?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{ec:r,ic:n,zi:o,mutatedKeys:i}}rc(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const s=this.ec;this.ec=t.ec,this.mutatedKeys=t.mutatedKeys;const i=t.ic.xu();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return T()}};return n(t)-n(e)}(t.type,e.type)||this.tc(t.doc,e.doc))),this.oc(n);const r=e?this.uc():[],o=0===this.Zu.size&&this.current?1:0,u=o!==this.Xu;return this.Xu=o,0!==i.length||u?{snapshot:new gs(this.query,t.ec,s,i,t.mutatedKeys,0===o,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),cc:r}:{cc:r}}Mu(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ec:this.ec,ic:new ps,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(t){return!this.Yu.has(t)&&!!this.ec.has(t)&&!this.ec.get(t).hasLocalMutations}oc(t){t&&(t.addedDocuments.forEach((t=>this.Yu=this.Yu.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Yu=this.Yu.delete(t))),this.current=t.current)}uc(){if(!this.current)return[];const t=this.Zu;this.Zu=Ze(),this.ec.forEach((t=>{this.ac(t.key)&&(this.Zu=this.Zu.add(t.key))}));const e=[];return t.forEach((t=>{this.Zu.has(t)||e.push(new Cs(t))})),this.Zu.forEach((n=>{t.has(n)||e.push(new Ss(n))})),e}hc(t){this.Yu=t.ir,this.Zu=Ze();const e=this.sc(t.documents);return this.applyChanges(e,!0)}lc(){return gs.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class _s{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Ds{constructor(t){this.key=t,this.fc=!1}}class ks{constructor(t,e,n,s,i,r){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=r,this.dc={},this.wc=new qe((t=>Pe(t)),Le),this._c=new Map,this.mc=new Set,this.gc=new gt(G.comparator),this.yc=new Map,this.Ic=new Qi,this.Tc={},this.Ec=new Map,this.Ac=qi.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}async function Ns(t,e){const n=Qs(t);let s,i;const r=n.wc.get(e);if(r)s=r.targetId,n.sharedClientState.addLocalQueryTarget(s),i=r.view.lc();else{const t=await fr(n.localStore,xe(e)),r=n.sharedClientState.addLocalQueryTarget(t.targetId);s=t.targetId,i=await Os(n,e,s,"current"===r,t.resumeToken),n.isPrimaryClient&&Ur(n.remoteStore,t)}return i}async function Os(t,e,n,s,i){t.Rc=(e,n,s)=>async function(t,e,n,s){let i=e.view.sc(n);i.zi&&(i=await gr(t.localStore,e.query,!1).then((({documents:t})=>e.view.sc(t,i))));const r=s&&s.targetChanges.get(e.targetId),o=e.view.applyChanges(i,t.isPrimaryClient,r);return qs(t,e.targetId,o.cc),o.snapshot}(t,e,n,s);const r=await gr(t.localStore,e,!0),o=new As(e,r.ir),u=o.sc(r.documents),c=Xn.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==t.onlineState,i),a=o.applyChanges(u,t.isPrimaryClient,c);qs(t,n,a.cc);const h=new _s(e,n,o);return t.wc.set(e,h),t._c.has(n)?t._c.get(n).push(e):t._c.set(n,[e]),a.snapshot}async function xs(t,e){const n=C(t),s=n.wc.get(e),i=n._c.get(s.targetId);if(i.length>1)return n._c.set(s.targetId,i.filter((t=>!Le(t,e)))),void n.wc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await pr(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),jr(n.remoteStore,s.targetId),js(n,s.targetId)})).catch(tt)):(js(n,s.targetId),await pr(n.localStore,s.targetId,!0))}async function Rs(t,e){const n=C(t);try{const t=await function(t,e){const n=C(t),s=e.snapshotVersion;let i=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const r=n.Zi.newChangeBuffer({trackRemovals:!0});i=n.Ji;const o=[];e.targetChanges.forEach(((r,u)=>{const c=i.get(u);if(!c)return;o.push(n.Bs.removeMatchingKeys(t,r.removedDocuments,u).next((()=>n.Bs.addMatchingKeys(t,r.addedDocuments,u))));let a=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(u)?a=a.withResumeToken(It.EMPTY_BYTE_STRING,rt.min()).withLastLimboFreeSnapshotVersion(rt.min()):r.resumeToken.approximateByteSize()>0&&(a=a.withResumeToken(r.resumeToken,s)),i=i.insert(u,a),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,a,r)&&o.push(n.Bs.updateTargetData(t,a))}));let u=ze(),c=Ze();if(e.documentUpdates.forEach((s=>{e.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,s))})),o.push(lr(t,r,e.documentUpdates).next((t=>{u=t.nr,c=t.sr}))),!s.isEqual(rt.min())){const e=n.Bs.getLastRemoteSnapshotVersion(t).next((e=>n.Bs.setTargetsMetadata(t,t.currentSequenceNumber,s)));o.push(e)}return et.waitFor(o).next((()=>r.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,u,c))).next((()=>u))})).then((t=>(n.Ji=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const s=n.yc.get(e);s&&(S(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?s.fc=!0:t.modifiedDocuments.size>0?S(s.fc):t.removedDocuments.size>0&&(S(s.fc),s.fc=!1))})),await Ks(n,t,e)}catch(t){await tt(t)}}function Ms(t,e,n){const s=C(t);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const t=[];s.wc.forEach(((n,s)=>{const i=s.view.Mu(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=C(t);n.onlineState=e;let s=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.Mu(e)&&(s=!0)})),s&&Is(n)}(s.eventManager,e),t.length&&s.dc.nu(t),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function Ls(t,e,n){const s=C(t);s.sharedClientState.updateQueryState(e,"rejected",n);const i=s.yc.get(e),r=i&&i.key;if(r){let t=new gt(G.comparator);t=t.insert(r,Yt.newNoDocument(r,rt.min()));const n=Ze().add(r),i=new Yn(rt.min(),new Map,new gt(V),t,n);await Rs(s,i),s.gc=s.gc.remove(r),s.yc.delete(e),zs(s)}else await pr(s.localStore,e,!1).then((()=>js(s,e,n))).catch(tt)}async function Ps(t,e){const n=C(t),s=e.batch.batchId;try{const t=await function(t,e){const n=C(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const s=e.batch.keys(),i=n.Zi.newChangeBuffer({trackRemovals:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=et.resolve();return r.forEach((t=>{o=o.next((()=>s.getEntry(e,t))).next((e=>{const r=n.docVersions.get(t);S(null!==r),e.version.compareTo(r)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),s.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,s,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=Ze();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,s)))}))}(n.localStore,e);Us(n,s,null),Vs(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await Ks(n,t)}catch(t){await tt(t)}}async function Fs(t,e,n){const s=C(t);try{const t=await function(t,e){const n=C(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let s;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(S(null!==e),s=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,s,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,s))).next((()=>n.localDocuments.getDocuments(t,s)))}))}(s.localStore,e);Us(s,e,n),Vs(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await Ks(s,t)}catch(n){await tt(n)}}function Vs(t,e){(t.Ec.get(e)||[]).forEach((t=>{t.resolve()})),t.Ec.delete(e)}function Us(t,e,n){const s=C(t);let i=s.Tc[s.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.Tc[s.currentUser.toKey()]=i}}function js(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t._c.get(e))t.wc.delete(s),n&&t.dc.Pc(s,n);t._c.delete(e),t.isPrimaryClient&&t.Ic.Is(e).forEach((e=>{t.Ic.containsKey(e)||Bs(t,e)}))}function Bs(t,e){t.mc.delete(e.path.canonicalString());const n=t.gc.get(e);null!==n&&(jr(t.remoteStore,n),t.gc=t.gc.remove(e),t.yc.delete(n),zs(t))}function qs(t,e,n){for(const s of n)s instanceof Ss?(t.Ic.addReference(s.key,e),$s(t,s)):s instanceof Cs?(v("SyncEngine","Document no longer in limbo: "+s.key),t.Ic.removeReference(s.key,e),t.Ic.containsKey(s.key)||Bs(t,s.key)):T()}function $s(t,e){const n=e.key,s=n.path.canonicalString();t.gc.get(n)||t.mc.has(s)||(v("SyncEngine","New document in limbo: "+n),t.mc.add(s),zs(t))}function zs(t){for(;t.mc.size>0&&t.gc.size<t.maxConcurrentLimboResolutions;){const e=t.mc.values().next().value;t.mc.delete(e);const n=new G($.fromString(e)),s=t.Ac.next();t.yc.set(s,new Ds(n)),t.gc=t.gc.insert(n,s),Ur(t.remoteStore,new Pi(xe(Ae(n.path)),s,"TargetPurposeLimboResolution",it.ct))}}async function Ks(t,e,n){const s=C(t),i=[],r=[],o=[];s.wc.isEmpty()||(s.wc.forEach(((t,u)=>{o.push(s.Rc(u,e,n).then((t=>{if((t||n)&&s.isPrimaryClient&&s.sharedClientState.updateQueryState(u.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){i.push(t);const e=rr.Li(u.targetId,t);r.push(e)}})))})),await Promise.all(o),s.dc.nu(i),await async function(t,e){const n=C(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>et.forEach(e,(e=>et.forEach(e.Fi,(s=>n.persistence.referenceDelegate.addReference(t,e.targetId,s))).next((()=>et.forEach(e.Bi,(s=>n.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))))))}catch(t){if(!nt(t))throw t;v("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ji.get(e),s=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(s);n.Ji=n.Ji.insert(e,i)}}}(s.localStore,r))}async function Gs(t,e){const n=C(t);if(!n.currentUser.isEqual(e)){v("SyncEngine","User change. New user:",e.toKey());const t=await cr(n.localStore,e);n.currentUser=e,function(t,e){t.Ec.forEach((t=>{t.forEach((t=>{t.reject(new A(q.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ec.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Ks(n,t.er)}}function Hs(t,e){const n=C(t),s=n.yc.get(e);if(s&&s.fc)return Ze().add(s.key);{let t=Ze();const s=n._c.get(e);if(!s)return t;for(const e of s){const s=n.wc.get(e);t=t.unionWith(s.view.nc)}return t}}function Qs(t){const e=C(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Rs.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Hs.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Ls.bind(null,e),e.dc.nu=bs.bind(null,e.eventManager),e.dc.Pc=Es.bind(null,e.eventManager),e}function Ws(t){const e=C(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Ps.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Fs.bind(null,e),e}class Ys{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=kr(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return ar(this.persistence,new sr,t.initialUser,this.serializer)}createPersistence(t){return new er(ir.zs,this.serializer)}createSharedClientState(t){return new vr}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Xs{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Ms(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Gs.bind(null,this.syncEngine),await cs(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new ys}createDatastore(t){const e=kr(t.databaseInfo.databaseId),n=(s=t.databaseInfo,new _r(s));var s;return function(t,e,n,s){return new Mr(t,e,n,s)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,s=t.asyncQueue,i=t=>Ms(this.syncEngine,t,0),r=Er.D()?new Er:new wr,new Pr(e,n,s,i,r);var e,n,s,i,r}createSyncEngine(t,e){return function(t,e,n,s,i,r,o){const u=new ks(t,e,n,s,i,r);return o&&(u.vc=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=C(t);v("RemoteStore","RemoteStore shutting down."),e.vu.add(5),await Vr(e),e.Pu.shutdown(),e.bu.set("Unknown")}(this.remoteStore)}}class Js{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Sc(this.observer.next,t)}error(t){this.observer.error?this.Sc(this.observer.error,t):w("Uncaught Error in snapshot listener:",t.toString())}Dc(){this.muted=!0}Sc(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Zs{constructor(t,e,n,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=d.UNAUTHENTICATED,this.clientId=F.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{v("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(v("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new A(q.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new _;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=ds(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function to(t,e){t.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener((async t=>{s.isEqual(t)||(await cr(e.localStore,t),s=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function eo(t,e){t.asyncQueue.verifyOperationInProgress();const n=await io(t);v("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.setCredentialChangeListener((t=>as(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>as(e.remoteStore,n))),t._onlineComponents=e}function no(t){return"FirebaseError"===t.name?t.code===q.FAILED_PRECONDITION||t.code===q.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}async function io(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){v("FirestoreClient","Using user provided OfflineComponentProvider");try{await to(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!no(n))throw n;E("Error using user provided cache. Falling back to memory cache: "+n),await to(t,new Ys)}}else v("FirestoreClient","Using default OfflineComponentProvider"),await to(t,new Ys);return t._offlineComponents}async function ro(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(v("FirestoreClient","Using user provided OnlineComponentProvider"),await eo(t,t._uninitializedComponentsProvider._online)):(v("FirestoreClient","Using default OnlineComponentProvider"),await eo(t,new Xs))),t._onlineComponents}function so(t){return ro(t).then((t=>t.syncEngine))}async function oo(t){const e=await ro(t),n=e.eventManager;return n.onListen=Ns.bind(null,e.syncEngine),n.onUnlisten=xs.bind(null,e.syncEngine),n}function ao(t,e,n={}){const s=new _;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new Js({next:r=>{e.enqueueAndForget((()=>ws(t,o)));const u=r.docs.has(n);!u&&r.fromCache?i.reject(new A(q.UNAVAILABLE,"Failed to get document because the client is offline.")):u&&r.fromCache&&s&&"server"===s.source?i.reject(new A(q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(r)},error:t=>i.reject(t)}),o=new Ts(Ae(n.path),r,{includeMetadataChanges:!0,Ku:!0});return vs(t,o)}(await oo(t),t.asyncQueue,e,n,s))),s.promise}function co(t,e,n={}){const s=new _;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,i){const r=new Js({next:n=>{e.enqueueAndForget((()=>ws(t,o))),n.fromCache&&"server"===s.source?i.reject(new A(q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:t=>i.reject(t)}),o=new Ts(n,r,{includeMetadataChanges:!0,Ku:!0});return vs(t,o)}(await oo(t),t.asyncQueue,e,n,s))),s.promise}function th(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const uo=new Map;function ho(t,e,n){if(!n)throw new A(q.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function lo(t){if(!G.isDocumentKey(t))throw new A(q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function fo(t){if(G.isDocumentKey(t))throw new A(q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function po(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":T()}function go(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new A(q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=po(t);throw new A(q.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function mo(t,e){if(e<=0)throw new A(q.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class yo{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new A(q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.cache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new A(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,s){if(!0===e&&!0===s)throw new A(q.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)})("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=th(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new A(q.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new A(q.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new A(q.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(e=this.experimentalLongPollingOptions,n=t.experimentalLongPollingOptions,e.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams;var e,n}}class vo{constructor(t,e,n,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yo({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new A(q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new A(q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yo(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new k;switch(t.type){case"firstParty":return new R(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new A(q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=uo.get(t);e&&(v("ComponentProvider","Removing Datastore"),uo.delete(t),e.terminate())}(this),Promise.resolve()}}class wo{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Eo(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new wo(this.firestore,t,this._key)}}class bo{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new bo(this.firestore,t,this._query)}}class Eo extends bo{constructor(t,e,n){super(t,e,Ae(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new wo(this.firestore,null,new G(t))}withConverter(t){return new Eo(this.firestore,t,this._path)}}function Io(t,e,...n){if(t=Object(h.p)(t),ho("collection","path",e),t instanceof vo){const s=$.fromString(e,...n);return fo(s),new Eo(t,null,s)}{if(!(t instanceof wo||t instanceof Eo))throw new A(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child($.fromString(e,...n));return fo(s),new Eo(t.firestore,null,s)}}function To(t,e,...n){if(t=Object(h.p)(t),1===arguments.length&&(e=F.A()),ho("doc","path",e),t instanceof vo){const s=$.fromString(e,...n);return lo(s),new wo(t,null,new G(s))}{if(!(t instanceof wo||t instanceof Eo))throw new A(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child($.fromString(e,...n));return lo(s),new wo(t.firestore,t instanceof Eo?t.converter:null,new G(s))}}class So{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new Nr(this,"async_queue_retry"),this.Xc=()=>{const t=Dr();t&&v("AsyncQueue","Visibility state changed to "+t.visibilityState),this.qo.Mo()};const t=Dr();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Zc(),this.ta(t)}enterRestrictedMode(t){if(!this.jc){this.jc=!0,this.Jc=t||!1;const e=Dr();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Xc)}}enqueue(t){if(this.Zc(),this.jc)return new Promise((()=>{}));const e=new _;return this.ta((()=>this.jc&&this.Jc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Qc.push(t),this.ea())))}async ea(){if(0!==this.Qc.length){try{await this.Qc[0](),this.Qc.shift(),this.qo.reset()}catch(t){if(!nt(t))throw t;v("AsyncQueue","Operation failed with retryable error: "+t)}this.Qc.length>0&&this.qo.No((()=>this.ea()))}}ta(t){const e=this.Gc.then((()=>(this.Hc=!0,t().catch((t=>{this.Wc=t,this.Hc=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw w("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Hc=!1,t))))));return this.Gc=e,e}enqueueAfterDelay(t,e,n){this.Zc(),this.Yc.indexOf(t)>-1&&(e=0);const s=ls.createAndSchedule(this,t,e,n,(t=>this.na(t)));return this.zc.push(s),s}Zc(){this.Wc&&T()}verifyOperationInProgress(){}async sa(){let t;do{t=this.Gc,await t}while(t!==this.Gc)}ia(t){for(const e of this.zc)if(e.timerId===t)return!0;return!1}ra(t){return this.sa().then((()=>{this.zc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.zc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.sa()}))}oa(t){this.Yc.push(t)}na(t){const e=this.zc.indexOf(t);this.zc.splice(e,1)}}class Co extends vo{constructor(t,e,n,s){super(t,e,n,s),this.type="firestore",this._queue=new So,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Do(this),this._firestoreClient.terminate()}}function Ao(t,e){const s="object"==typeof t?t:Object(r.e)(),i="string"==typeof t?t:e||"(default)",n=Object(r.b)(s,"firestore").getImmediate({identifier:i});if(!n._initialized){const t=Object(h.n)("firestore");t&&function(t,e,n,s={}){var i;const r=(t=go(t,vo))._getSettings();if("firestore.googleapis.com"!==r.host&&r.host!==e&&E("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:`${e}:${n}`,ssl:!1})),s.mockUserToken){let e,n;if("string"==typeof s.mockUserToken)e=s.mockUserToken,n=d.MOCK_USER;else{e=Object(h.h)(s.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const r=s.mockUserToken.sub||s.mockUserToken.user_id;if(!r)throw new A(q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new d(r)}t._authCredentials=new N(new D(e,n))}}(n,...t)}return n}function _o(t){return t._firestoreClient||Do(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Do(t){var e,n,s;const i=t._freezeSettings(),r=function(t,e,n,s){return new Nt(t,e,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,th(s.experimentalLongPollingOptions),s.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new Zs(t._authCredentials,t._appCheckCredentials,t._queue,r),(null===(n=i.cache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(s=i.cache)||void 0===s?void 0:s._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.cache.kind,_offline:i.cache._offlineComponentProvider,_online:i.cache._onlineComponentProvider})}class ko{constructor(t){this._byteString=t}static fromBase64String(t){try{return new ko(It.fromBase64String(t))}catch(t){throw new A(q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new ko(It.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class No{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new A(q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new K(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Oo{constructor(t){this._methodName=t}}class xo{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new A(q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new A(q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return V(this._lat,t._lat)||V(this._long,t._long)}}const Ro=/^__.*__$/;class Mo{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new kn(t,this.data,this.fieldMask,e,this.fieldTransforms):new Dn(t,this.data,e,this.fieldTransforms)}}class Lo{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new kn(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Po(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw T()}}class Fo{constructor(t,e,n,s,i,r){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.ua(),this.fieldTransforms=i||[],this.fieldMask=r||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(t){return new Fo(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.aa({path:n,la:!1});return s.fa(t),s}da(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.aa({path:n,la:!1});return s.ua(),s}wa(t){return this.aa({path:void 0,la:!0})}_a(t){return Xo(t,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}ua(){if(this.path)for(let t=0;t<this.path.length;t++)this.fa(this.path.get(t))}fa(t){if(0===t.length)throw this._a("Document fields must not be empty");if(Po(this.ca)&&Ro.test(t))throw this._a('Document fields cannot begin and end with "__"')}}class Vo{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||kr(t)}ya(t,e,n,s=!1){return new Fo({ca:t,methodName:e,ga:n,path:K.emptyPath(),la:!1,ma:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Uo(t){const e=t._freezeSettings(),n=kr(t._databaseId);return new Vo(t._databaseId,!!e.ignoreUndefinedProperties,n)}function jo(t,e,n,s,i,r={}){const o=t.ya(r.merge||r.mergeFields?2:0,e,n,i);dl("Data must be an object, but it was:",o,s);const u=Go(s,o);let c,a;if(r.merge)c=new bt(o.fieldMask),a=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){const i=Qo(e,s,n);if(!o.contains(i))throw new A(q.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Jo(t,i)||t.push(i)}c=new bt(t),a=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,a=o.fieldTransforms;return new Mo(new Qt(u),c,a)}class Bo extends Oo{_toFieldTransform(t){if(2!==t.ca)throw 1===t.ca?t._a(`${this._methodName}() can only appear at the top level of your update data`):t._a(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Bo}}class qo extends Oo{_toFieldTransform(t){return new vn(t.path,new hn)}isEqual(t){return t instanceof qo}}function ul(t,e,n,s){const i=t.ya(1,e,n);dl("Data must be an object, but it was:",i,s);const r=[],o=Qt.empty();ft(s,((t,s)=>{const u=Yo(e,t,n);s=Object(h.p)(s);const c=i.da(u);if(s instanceof Bo)r.push(u);else{const t=Ko(s,c);null!=t&&(r.push(u),o.set(u,t))}}));const u=new bt(r);return new Lo(o,u,i.fieldTransforms)}function $o(t,e,n,s,i,r){const o=t.ya(1,e,n),u=[Qo(e,s,n)],c=[i];if(r.length%2!=0)throw new A(q.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)u.push(Qo(e,r[t])),c.push(r[t+1]);const a=[],l=Qt.empty();for(let t=u.length-1;t>=0;--t)if(!Jo(a,u[t])){const e=u[t];let n=c[t];n=Object(h.p)(n);const s=o.da(e);if(n instanceof Bo)a.push(e);else{const t=Ko(n,s);null!=t&&(a.push(e),l.set(e,t))}}const d=new bt(a);return new Lo(l,d,o.fieldTransforms)}function zo(t,e,n,s=!1){return Ko(n,t.ya(s?4:3,e))}function Ko(t,e){if(Ho(t=Object(h.p)(t)))return dl("Unsupported field value:",e,t),Go(t,e);if(t instanceof Oo)return function(t,e){if(!Po(e.ca))throw e._a(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e._a(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.la&&4!==e.ca)throw e._a("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=Ko(i,e.wa(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(h.p)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return sn(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=j.fromDate(t);return{timestampValue:hi(e.serializer,n)}}if(t instanceof j){const n=new j(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:hi(e.serializer,n)}}if(t instanceof xo)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof ko)return{bytesValue:di(e.serializer,t._byteString)};if(t instanceof wo){const n=e.databaseId,s=t.firestore._databaseId;if(!s.isEqual(n))throw e._a(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:gi(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e._a(`Unsupported field value: ${po(t)}`)}(t,e)}function Go(t,e){const n={};return pt(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ft(t,((t,s)=>{const i=Ko(s,e.ha(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Ho(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof j||t instanceof xo||t instanceof ko||t instanceof wo||t instanceof Oo)}function dl(t,e,n){if(!Ho(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=po(n);throw"an object"===s?e._a(t+" a custom object"):e._a(t+" "+s)}}function Qo(t,e,n){if((e=Object(h.p)(e))instanceof No)return e._internalPath;if("string"==typeof e)return Yo(t,e);throw Xo("Field path arguments must be of type string or ",t,!1,void 0,n)}const Wo=new RegExp("[~\\*/\\[\\]]");function Yo(t,e,n){if(e.search(Wo)>=0)throw Xo(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new No(...e.split("."))._internalPath}catch(r){throw Xo(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Xo(t,e,n,s,i){const r=s&&!s.isEmpty(),o=void 0!==i;let u=`Function ${e}() called with invalid data`;n&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${s}`),o&&(c+=` in document ${i}`),c+=")"),new A(q.INVALID_ARGUMENT,u+t+c)}function Jo(t,e){return t.some((t=>t.isEqual(e)))}class Zo{constructor(t,e,n,s,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new wo(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new ta(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(ea("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class ta extends Zo{data(){return super.data()}}function ea(t,e){return"string"==typeof e?Yo(t,e):e instanceof No?e._internalPath:e._delegate._internalPath}function na(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new A(q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ia{}class ra extends ia{}function sa(t,e,...n){let s=[];e instanceof ia&&s.push(e),s=s.concat(n),function(t){const e=t.filter((t=>t instanceof ca)).length,n=t.filter((t=>t instanceof oa)).length;if(e>1||e>0&&n>0)throw new A(q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(s);for(const e of s)t=e._apply(t);return t}class oa extends ra{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new oa(t,e,n)}_apply(t){const e=this._parse(t);return ga(t._query,e),new bo(t.firestore,t.converter,Re(t._query,e))}_parse(t){const e=Uo(t.firestore),n=function(t,e,n,s,i,r,o){let u;if(i.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new A(q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on documentId().`);if("in"===r||"not-in"===r){pa(o,r);const e=[];for(const n of o)e.push(fa(s,t,n));u={arrayValue:{values:e}}}else u=fa(s,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||pa(o,r),u=zo(n,"where",o,"in"===r||"not-in"===r);return ie.create(i,r,u)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}function aa(t,e,n){const s=e,i=ea("where",t);return oa._create(i,s,n)}class ca extends ia{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new ca(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:re.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const s=e.getFlattenedFilters();for(const t of s)ga(n,t),n=Re(n,t)}(t._query,e),new bo(t.firestore,t.converter,Re(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class ua extends ra{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new ua(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new A(q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new A(q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new te(e,n);return function(t,e){if(null===De(t)){const n=ke(t);null!==n&&ma(t,n,e.field)}}(t,s),s}(t._query,this._field,this._direction);return new bo(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new Se(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function ha(t,e="asc"){const n=e,s=ea("orderBy",t);return ua._create(s,n)}class la extends ra{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new la(t,e,n)}_apply(t){return new bo(t.firestore,t.converter,Me(t._query,this._limit,this._limitType))}}function da(t){return mo("limit",t),la._create("limit",t,"F")}function fa(t,e,n){if("string"==typeof(n=Object(h.p)(n))){if(""===n)throw new A(q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ne(e)&&-1!==n.indexOf("/"))throw new A(q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child($.fromString(n));if(!G.isDocumentKey(s))throw new A(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return jt(t,new G(s))}if(n instanceof wo)return jt(t,n._key);throw new A(q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${po(n)}.`)}function pa(t,e){if(!Array.isArray(t)||0===t.length)throw new A(q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function ga(t,e){if(e.isInequality()){const n=ke(t),s=e.field;if(null!==n&&!n.isEqual(s))throw new A(q.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${s.toString()}'`);const i=De(t);null!==i&&ma(t,s,i)}const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new A(q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new A(q.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function ma(t,e,n){if(!n.isEqual(e))throw new A(q.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class ya{convertValue(t,e="none"){switch(Rt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ct(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(At(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw T()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return ft(t,((t,s)=>{n[t]=this.convertValue(s,e)})),n}convertGeoPoint(t){return new xo(Ct(t.latitude),Ct(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Dt(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(kt(t));default:return null}}convertTimestamp(t){const e=St(t);return new j(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=$.fromString(t);S(Li(n));const s=new Ot(n.get(1),n.get(3)),i=new G(n.popFirst(5));return s.isEqual(e)||w(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}function va(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}class wa{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class ba extends Zo{constructor(t,e,n,s,i,r){super(t,e,n,s,r),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Ea(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(ea("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Ea extends ba{data(t={}){return super.data(t)}}class Ia{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new wa(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Ea(this._firestore,this._userDataWriter,n.key,n,new wa(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new A(q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const s=new Ea(t._firestore,t._userDataWriter,n.doc.key,n.doc,new wa(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:s,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const s=new Ea(t._firestore,t._userDataWriter,e.doc.key,e.doc,new wa(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,r=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),r=n.indexOf(e.doc.key)),{type:Ta(e.type),doc:s,oldIndex:i,newIndex:r}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Ta(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return T()}}function Sa(t){t=go(t,wo);const e=go(t.firestore,Co);return ao(_o(e),t._key).then((n=>Oa(e,t,n)))}class Ca extends ya{constructor(t){super(),this.firestore=t}convertBytes(t){return new ko(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new wo(this.firestore,null,e)}}function Aa(t){t=go(t,bo);const e=go(t.firestore,Co),n=_o(e),s=new Ca(e);return na(t._query),co(n,t._query).then((n=>new Ia(e,s,t,n)))}function _a(t,e,n){t=go(t,wo);const s=go(t.firestore,Co),i=va(t.converter,e,n);return Na(s,[jo(Uo(s),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,bn.none())])}function Da(t,e,n,...s){t=go(t,wo);const i=go(t.firestore,Co),r=Uo(i);let o;return o="string"==typeof(e=Object(h.p)(e))||e instanceof No?$o(r,"updateDoc",t._key,e,n,s):ul(r,"updateDoc",t._key,e),Na(i,[o.toMutation(t._key,bn.exists(!0))])}function ka(t,e){const n=go(t.firestore,Co),s=To(t),i=va(t.converter,e);return Na(n,[jo(Uo(t.firestore),"addDoc",s._key,i,null!==t.converter,{}).toMutation(s._key,bn.exists(!1))]).then((()=>s))}function Na(t,e){return function(t,e){const n=new _;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const s=Ws(t);try{const t=await function(t,e){const n=C(t),s=j.now(),i=e.reduce(((t,e)=>t.add(e.key)),Ze());let r,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let u=ze(),c=Ze();return n.Zi.getEntries(t,i).next((t=>{u=t,u.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,u))).next((i=>{r=i;const o=[];for(const t of e){const e=An(t,r.get(t.key).overlayedDocument);null!=e&&o.push(new kn(t.key,e,Wt(e.value.mapValue),bn.exists(!0)))}return n.mutationQueue.addMutationBatch(t,s,o,e)})).next((e=>{o=e;const s=e.applyToLocalDocumentSet(r,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,s)}))})).then((()=>({batchId:o.batchId,changes:He(r)})))}(s.localStore,e);s.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let s=t.Tc[t.currentUser.toKey()];s||(s=new gt(V)),s=s.insert(e,n),t.Tc[t.currentUser.toKey()]=s}(s,t.batchId,n),await Ks(s,t.changes),await Jr(s.remoteStore)}catch(t){const e=ds(t,"Failed to persist write");n.reject(e)}}(await so(t),e,n))),n.promise}(_o(t),e)}function Oa(t,e,n){const s=n.docs.get(e._key),i=new Ca(t);return new ba(t,i,e._key,s,new wa(n.hasPendingWrites,n.fromCache),e.converter)}function xa(){return new qo("serverTimestamp")}!function(t,e=!0){!function(t){f=t}(r.a),Object(r.c)(new o.a("firestore",((t,{instanceIdentifier:n,options:s})=>{const i=t.getProvider("app").getImmediate(),r=new Co(new O(t.getProvider("auth-internal")),new L(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new A(q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ot(t.options.projectId,e)}(i,n),i);return s=Object.assign({useFetchStreams:e},s),r._setSettings(s),r}),"PUBLIC").setMultipleInstances(!0)),Object(r.g)(b,"3.12.0",t),Object(r.g)(b,"3.12.0","esm2017")}()}).call(this,n(185))},538:function(t,e,n){"use strict";var r=n(578);n.d(e,"a",(function(){return r.f}));Object(r.g)("firebase","9.22.0","app")},546:function(t,e,n){"use strict";n.d(e,"a",(function(){return ce}));var r=n(578),o=n(608),c=n(564),h=n(599);const l=(object,t)=>t.some((t=>object instanceof t));let d,f;const m=new WeakMap,y=new WeakMap,v=new WeakMap,w=new WeakMap,E=new WeakMap;let I={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return y.get(t);if("objectStoreNames"===e)return t.objectStoreNames||v.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return C(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function T(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(f||(f=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(A(this),e),C(m.get(this))}:function(...e){return C(t.apply(A(this),e))}:function(e,...n){const r=t.call(A(this),e,...n);return v.set(r,e.sort?e.sort():[e]),C(r)}}function S(t){return"function"==typeof t?T(t):(t instanceof IDBTransaction&&function(t){if(y.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",c),t.removeEventListener("abort",c)},o=()=>{e(),r()},c=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",o),t.addEventListener("error",c),t.addEventListener("abort",c)}));y.set(t,e)}(t),l(t,d||(d=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,I):t)}function C(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",o),t.removeEventListener("error",c)},o=()=>{e(C(t.result)),r()},c=()=>{n(t.error),r()};t.addEventListener("success",o),t.addEventListener("error",c)}));return e.then((e=>{e instanceof IDBCursor&&m.set(e,t)})).catch((()=>{})),E.set(e,t),e}(t);if(w.has(t))return w.get(t);const e=S(t);return e!==t&&(w.set(t,e),E.set(e,t)),e}const A=t=>E.get(t);const _=["get","getKey","getAll","getAllKeys","count"],D=["put","add","delete","clear"],k=new Map;function N(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(k.get(e))return k.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,o=D.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!_.includes(n))return;const c=async function(t,...e){const c=this.transaction(t,o?"readwrite":"readonly");let h=c.store;return r&&(h=h.index(e.shift())),(await Promise.all([h[n](...e),o&&c.done]))[0]};return k.set(e,c),c}I=(t=>({...t,get:(e,n,r)=>N(e,n)||t.get(e,n,r),has:(e,n)=>!!N(e,n)||t.has(e,n)}))(I);const O="@firebase/installations",x="0.6.4",R=1e4,M=`w:${x}`,L="FIS_v2",P="https://firebaseinstallations.googleapis.com/v1",F=36e5,V={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},U=new c.b("installations","Installations",V);function j(t){return t instanceof c.c&&t.code.includes("request-failed")}function B({projectId:t}){return`${P}/projects/${t}/installations`}function $(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function z(t,e){const n=(await e.json()).error;return U.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function K({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function G(t,{refreshToken:e}){const n=K(t);return n.append("Authorization",function(t){return`${L} ${t}`}(e)),n}async function H(t){const e=await t();return e.status>=500&&e.status<600?t():e}function Q(t){return new Promise((e=>{setTimeout(e,t)}))}const W=/^[cdef][\w-]{21}$/,Y="";function X(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){const e=(n=t,btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_"));var n;return e.substr(0,22)}(t);return W.test(e)?e:Y}catch(t){return Y}}function J(t){return`${t.appName}!${t.appId}`}const Z=new Map;function tt(t,e){const n=J(t);et(n,e),function(t,e){const n=it();n&&n.postMessage({key:t,fid:e});st()}(n,e)}function et(t,e){const n=Z.get(t);if(n)for(const t of n)t(e)}let nt=null;function it(){return!nt&&"BroadcastChannel"in self&&(nt=new BroadcastChannel("[Firebase] FID Change"),nt.onmessage=t=>{et(t.data.key,t.data.fid)}),nt}function st(){0===Z.size&&nt&&(nt.close(),nt=null)}const ot="firebase-installations-database",at=1,ct="firebase-installations-store";let ut=null;function ht(){return ut||(ut=function(t,e,{blocked:n,upgrade:r,blocking:o,terminated:c}={}){const h=indexedDB.open(t,e),l=C(h);return r&&h.addEventListener("upgradeneeded",(t=>{r(C(h.result),t.oldVersion,t.newVersion,C(h.transaction))})),n&&h.addEventListener("blocked",(()=>n())),l.then((t=>{c&&t.addEventListener("close",(()=>c())),o&&t.addEventListener("versionchange",(()=>o()))})).catch((()=>{})),l}(ot,at,{upgrade:(t,e)=>{if(0===e)t.createObjectStore(ct)}})),ut}async function lt(t,e){const n=J(t),r=(await ht()).transaction(ct,"readwrite"),o=r.objectStore(ct),c=await o.get(n);return await o.put(e,n),await r.done,c&&c.fid===e.fid||tt(t,e.fid),e}async function ft(t){const e=J(t),n=(await ht()).transaction(ct,"readwrite");await n.objectStore(ct).delete(e),await n.done}async function pt(t,e){const n=J(t),r=(await ht()).transaction(ct,"readwrite"),o=r.objectStore(ct),c=await o.get(n),h=e(c);return void 0===h?await o.delete(n):await o.put(h,n),await r.done,!h||c&&c.fid===h.fid||tt(t,h.fid),h}async function gt(t){let e;const n=await pt(t.appConfig,(n=>{const r=function(t){const e=t||{fid:X(),registrationStatus:0};return vt(e)}(n),o=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine){return{installationEntry:e,registrationPromise:Promise.reject(U.create("app-offline"))}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=B(t),o=K(t),c=e.getImmediate({optional:!0});if(c){const t=await c.getHeartbeatsHeader();t&&o.append("x-firebase-client",t)}const body={fid:n,authVersion:L,appId:t.appId,sdkVersion:M},h={method:"POST",headers:o,body:JSON.stringify(body)},l=await H((()=>fetch(r,h)));if(l.ok){const t=await l.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:$(t.authToken)}}throw await z("Create Installation",l)}(t,e);return lt(t.appConfig,n)}catch(n){throw j(n)&&409===n.customData.serverCode?await ft(t.appConfig):await lt(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:r}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:mt(t)}:{installationEntry:e}}(t,r);return e=o.registrationPromise,o.installationEntry}));return n.fid===Y?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function mt(t){let e=await yt(t.appConfig);for(;1===e.registrationStatus;)await Q(100),e=await yt(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await gt(t);return n||e}return e}function yt(t){return pt(t,(t=>{if(!t)throw U.create("installation-not-found");return vt(t)}))}function vt(t){return 1===(e=t).registrationStatus&&e.registrationTime+R<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function wt({appConfig:t,heartbeatServiceProvider:e},n){const r=function(t,{fid:e}){return`${B(t)}/${e}/authTokens:generate`}(t,n),o=G(t,n),c=e.getImmediate({optional:!0});if(c){const t=await c.getHeartbeatsHeader();t&&o.append("x-firebase-client",t)}const body={installation:{sdkVersion:M,appId:t.appId}},h={method:"POST",headers:o,body:JSON.stringify(body)},l=await H((()=>fetch(r,h)));if(l.ok){return $(await l.json())}throw await z("Generate Auth Token",l)}async function bt(t,e=!1){let n;const r=await pt(t.appConfig,(r=>{if(!It(r))throw U.create("not-registered");const o=r.authToken;if(!e&&function(t){return 2===t.requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+F}(t)}(o))return r;if(1===o.requestStatus)return n=async function(t,e){let n=await Et(t.appConfig);for(;1===n.authToken.requestStatus;)await Q(100),n=await Et(t.appConfig);const r=n.authToken;return 0===r.requestStatus?bt(t,e):r}(t,e),r;{if(!navigator.onLine)throw U.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(r);return n=async function(t,e){try{const n=await wt(t,e),r=Object.assign(Object.assign({},e),{authToken:n});return await lt(t.appConfig,r),n}catch(n){if(!j(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await lt(t.appConfig,n)}else await ft(t.appConfig);throw n}}(t,e),e}}));return n?await n:r.authToken}function Et(t){return pt(t,(t=>{if(!It(t))throw U.create("not-registered");const e=t.authToken;return 1===(n=e).requestStatus&&n.requestTime+R<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var n}))}function It(t){return void 0!==t&&2===t.registrationStatus}async function Tt(t,e=!1){const n=t;await async function(t){const{registrationPromise:e}=await gt(t);e&&await e}(n);return(await bt(n,e)).token}function St(t){return U.create("missing-app-config-values",{valueName:t})}const Ct="installations",At=t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw St("App Configuration");if(!t.name)throw St("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw St(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:Object(r.b)(e,"heartbeat"),_delete:()=>Promise.resolve()}},_t=t=>{const e=t.getProvider("app").getImmediate(),n=Object(r.b)(e,Ct).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:r}=await gt(e);return r?r.catch(console.error):bt(e).catch(console.error),n.fid}(n),getToken:t=>Tt(n,t)}};Object(r.c)(new h.a(Ct,At,"PUBLIC")),Object(r.c)(new h.a("installations-internal",_t,"PRIVATE")),Object(r.g)(O,x),Object(r.g)(O,x,"esm2017");const Dt="analytics",kt="firebase_id",Nt="origin",Ot=6e4,xt="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Rt="https://www.googletagmanager.com/gtag/js",Mt=new o.b("@firebase/analytics"),Lt={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Pt=new c.b("analytics","Analytics",Lt);function Ft(t){if(!t.startsWith(Rt)){const e=Pt.create("invalid-gtag-resource",{gtagURL:t});return Mt.warn(e.message),""}return t}function Vt(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}function Ut(t,e){const n=function(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}("firebase-js-sdk-policy",{createScriptURL:Ft}),script=document.createElement("script"),r=`${Rt}?l=${t}&id=${e}`;script.src=n?null==n?void 0:n.createScriptURL(r):r,script.async=!0,document.head.appendChild(script)}function jt(t,e,n,r){return async function(o,...c){try{if("event"===o){const[r,o]=c;await async function(t,e,n,r,o){try{let c=[];if(o&&o.send_to){let t=o.send_to;Array.isArray(t)||(t=[t]);const r=await Vt(n);for(const n of t){const t=r.find((t=>t.measurementId===n)),o=t&&e[t.appId];if(!o){c=[];break}c.push(o)}}0===c.length&&(c=Object.values(e)),await Promise.all(c),t("event",r,o||{})}catch(t){Mt.error(t)}}(t,e,n,r,o)}else if("config"===o){const[o,h]=c;await async function(t,e,n,r,o,c){const h=r[o];try{if(h)await e[h];else{const t=(await Vt(n)).find((t=>t.measurementId===o));t&&await e[t.appId]}}catch(t){Mt.error(t)}t("config",o,c)}(t,e,n,r,o,h)}else if("consent"===o){const[e]=c;t("consent","update",e)}else if("get"===o){const[e,n,r]=c;t("get",e,n,r)}else if("set"===o){const[e]=c;t("set",e)}else t(o,...c)}catch(t){Mt.error(t)}}}const Bt=30;const qt=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function $t(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function zt(t,e=qt,n){const{appId:r,apiKey:o,measurementId:c}=t.options;if(!r)throw Pt.create("no-app-id");if(!o){if(c)return{measurementId:c,appId:r};throw Pt.create("no-api-key")}const h=e.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},l=new Gt;return setTimeout((async()=>{l.abort()}),void 0!==n?n:Ot),Kt({appId:r,apiKey:o,measurementId:c},h,l,e)}async function Kt(t,{throttleEndTimeMillis:e,backoffCount:n},r,o=qt){var h;const{appId:l,measurementId:d}=t;try{await function(t,e){return new Promise(((n,r)=>{const o=Math.max(e-Date.now(),0),c=setTimeout(n,o);t.addEventListener((()=>{clearTimeout(c),r(Pt.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(r,e)}catch(t){if(d)return Mt.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${d} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:l,measurementId:d};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:r}=t,o={method:"GET",headers:$t(r)},c=xt.replace("{app-id}",n),h=await fetch(c,o);if(200!==h.status&&304!==h.status){let t="";try{const n=await h.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw Pt.create("config-fetch-failed",{httpStatus:h.status,responseMessage:t})}return h.json()}(t);return o.deleteThrottleMetadata(l),e}catch(e){const f=e;if(!function(t){if(!(t instanceof c.c&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(f)){if(o.deleteThrottleMetadata(l),d)return Mt.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${d} provided in the "measurementId" field in the local Firebase config. [${null==f?void 0:f.message}]`),{appId:l,measurementId:d};throw e}const m=503===Number(null===(h=null==f?void 0:f.customData)||void 0===h?void 0:h.httpStatus)?Object(c.g)(n,o.intervalMillis,Bt):Object(c.g)(n,o.intervalMillis),y={throttleEndTimeMillis:Date.now()+m,backoffCount:n+1};return o.setThrottleMetadata(l,y),Mt.debug(`Calling attemptFetch again in ${m} millis`),Kt(t,y,r,o)}}class Gt{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let Ht,Qt;function Wt(t){Qt=t}function Yt(t){Ht=t}async function Xt(t,e,n,r,o,h,l){var d;const f=zt(t);f.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Mt.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>Mt.error(t))),e.push(f);const m=async function(){if(!Object(c.u)())return Mt.warn(Pt.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await Object(c.A)()}catch(t){return Mt.warn(Pt.create("indexeddb-unavailable",{errorInfo:null==t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?r.getId():void 0)),[y,v]=await Promise.all([f,m]);(function(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(Rt)&&n.src.includes(t))return n;return null})(h)||Ut(h,y.measurementId),Qt&&(o("consent","default",Qt),Wt(void 0)),o("js",new Date);const w=null!==(d=null==l?void 0:l.config)&&void 0!==d?d:{};return w[Nt]="firebase",w.update=!0,null!=v&&(w[kt]=v),o("config",y.measurementId,w),Ht&&(o("set",Ht),Yt(void 0)),y.measurementId}class Jt{constructor(t){this.app=t}_delete(){return delete Zt[this.app.options.appId],Promise.resolve()}}let Zt={},te=[];const ee={};let ne,ie,re="dataLayer",se="gtag",oe=!1;function ae(t,e,n){!function(){const t=[];if(Object(c.r)()&&t.push("This is a browser extension environment."),Object(c.d)()||t.push("Cookies are not available."),t.length>0){const details=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),e=Pt.create("invalid-analytics-context",{errorInfo:details});Mt.warn(e.message)}}();const r=t.options.appId;if(!r)throw Pt.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw Pt.create("no-api-key");Mt.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Zt[r])throw Pt.create("already-exists",{id:r});if(!oe){!function(t){let e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(re);const{wrappedGtag:t,gtagCore:e}=function(t,e,n,r,o){let c=function(...t){window[r].push(arguments)};return window[o]&&"function"==typeof window[o]&&(c=window[o]),window[o]=jt(c,t,e,n),{gtagCore:c,wrappedGtag:window[o]}}(Zt,te,ee,re,se);ie=t,ne=e,oe=!0}Zt[r]=Xt(t,te,ee,e,ne,re,n);return new Jt(t)}function ce(t=Object(r.e)()){t=Object(c.p)(t);const e=Object(r.b)(t,Dt);return e.isInitialized()?e.getImmediate():function(t,e={}){const n=Object(r.b)(t,Dt);if(n.isInitialized()){const t=n.getImmediate();if(Object(c.j)(e,n.getOptions()))return t;throw Pt.create("already-initialized")}const o=n.initialize({options:e});return o}(t)}function ue(t,e,n,r){t=Object(c.p)(t),async function(t,e,n,r,o){if(o&&o.global)t("event",n,r);else{const o=await e;t("event",n,Object.assign(Object.assign({},r),{send_to:o}))}}(ie,Zt[t.app.options.appId],e,n,r).catch((t=>Mt.error(t)))}const he="@firebase/analytics",le="0.10.0";Object(r.c)(new h.a(Dt,((t,{options:e})=>ae(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),Object(r.c)(new h.a("analytics-internal",(function(t){try{const e=t.getProvider(Dt).getImmediate();return{logEvent:(t,n,r)=>ue(e,t,n,r)}}catch(t){throw Pt.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),Object(r.g)(he,le),Object(r.g)(he,le,"esm2017")},564:function(t,e,n){"use strict";(function(t,r){n.d(e,"a",(function(){return I})),n.d(e,"b",(function(){return M})),n.d(e,"c",(function(){return R})),n.d(e,"d",(function(){return x})),n.d(e,"e",(function(){return d})),n.d(e,"f",(function(){return l})),n.d(e,"g",(function(){return Y})),n.d(e,"h",(function(){return T})),n.d(e,"i",(function(){return $})),n.d(e,"j",(function(){return F})),n.d(e,"k",(function(){return B})),n.d(e,"l",(function(){return w})),n.d(e,"m",(function(){return y})),n.d(e,"n",(function(){return v})),n.d(e,"o",(function(){return E})),n.d(e,"p",(function(){return X})),n.d(e,"q",(function(){return S})),n.d(e,"r",(function(){return A})),n.d(e,"s",(function(){return P})),n.d(e,"t",(function(){return D})),n.d(e,"u",(function(){return N})),n.d(e,"v",(function(){return C})),n.d(e,"w",(function(){return _})),n.d(e,"x",(function(){return k})),n.d(e,"y",(function(){return U})),n.d(e,"z",(function(){return j})),n.d(e,"A",(function(){return O}));const o=function(t){const e=[];let p=0;for(let i=0;i<t.length;i++){let n=t.charCodeAt(i);n<128?e[p++]=n:n<2048?(e[p++]=n>>6|192,e[p++]=63&n|128):55296==(64512&n)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(n=65536+((1023&n)<<10)+(1023&t.charCodeAt(++i)),e[p++]=n>>18|240,e[p++]=n>>12&63|128,e[p++]=n>>6&63|128,e[p++]=63&n|128):(e[p++]=n>>12|224,e[p++]=n>>6&63|128,e[p++]=63&n|128)}return e},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(input,t){if(!Array.isArray(input))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,output=[];for(let i=0;i<input.length;i+=3){const t=input[i],n=i+1<input.length,r=n?input[i+1]:0,o=i+2<input.length,c=o?input[i+2]:0,h=t>>2,l=(3&t)<<4|r>>4;let d=(15&r)<<2|c>>6,f=63&c;o||(f=64,n||(d=64)),output.push(e[h],e[l],e[d],e[f])}return output.join("")},encodeString(input,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(input):this.encodeByteArray(o(input),t)},decodeString(input,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(input):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const o=t[n++];if(o<128)e[r++]=String.fromCharCode(o);else if(o>191&&o<224){const c=t[n++];e[r++]=String.fromCharCode((31&o)<<6|63&c)}else if(o>239&&o<365){const u=((7&o)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(1023&u))}else{const c=t[n++],h=t[n++];e[r++]=String.fromCharCode((15&o)<<12|(63&c)<<6|63&h)}}return e.join("")}(this.decodeStringToByteArray(input,t))},decodeStringToByteArray(input,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,output=[];for(let i=0;i<input.length;){const t=e[input.charAt(i++)],n=i<input.length?e[input.charAt(i)]:0;++i;const r=i<input.length?e[input.charAt(i)]:64;++i;const o=i<input.length?e[input.charAt(i)]:64;if(++i,null==t||null==n||null==r||null==o)throw new h;const c=t<<2|n>>4;if(output.push(c),64!==r){const t=n<<4&240|r>>2;if(output.push(t),64!==o){const t=r<<6&192|o;output.push(t)}}}return output},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let i=0;i<this.ENCODED_VALS.length;i++)this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i),this.charToByteMap_[this.byteToCharMap_[i]]=i,this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i,i>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i)}}};class h extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const l=function(t){return function(t){const e=o(t);return c.encodeByteArray(e,!0)}(t).replace(/\./g,"")},d=function(t){try{return c.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};const f=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,m=()=>{try{return f()||(()=>{if(void 0===r||void 0===r.env)return;const t=r.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&d(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},y=t=>{var e,n;return null===(n=null===(e=m())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]},v=t=>{const e=y(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]},w=()=>{var t;return null===(t=m())||void 0===t?void 0:t.config},E=t=>{var e;return null===(e=m())||void 0===e?void 0:e[`_${t}`]};class I{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function T(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,sub=t.sub||t.user_id;if(!sub)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:sub,user_id:sub,firebase:{sign_in_provider:"custom",identities:{}}},t);return[l(JSON.stringify({alg:"none",type:"JWT"})),l(JSON.stringify(o)),""].join(".")}function S(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function C(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(S())}function A(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function _(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function D(){const t=S();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function k(){return!function(){var e;const n=null===(e=m())||void 0===e?void 0:e.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(t.process)}catch(t){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function N(){try{return"object"==typeof indexedDB}catch(t){return!1}}function O(){return new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",o=self.indexedDB.open(r);o.onsuccess=()=>{o.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},o.onupgradeneeded=()=>{n=!1},o.onerror=()=>{var t;e((null===(t=o.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}function x(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class R extends Error{constructor(code,t,e){super(t),this.code=code,this.customData=e,this.name="FirebaseError",Object.setPrototypeOf(this,R.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,M.prototype.create)}}class M{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(code,...data){const t=data[0]||{},e=`${this.service}/${code}`,template=this.errors[code],n=template?function(template,data){return template.replace(L,((t,e)=>{const n=data[e];return null!=n?String(n):`<${e}?>`}))}(template,t):"Error",r=`${this.serviceName}: ${n} (${e}).`;return new R(e,r,t)}}const L=/\{\$([^}]+)}/g;function P(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function F(a,b){if(a===b)return!0;const t=Object.keys(a),e=Object.keys(b);for(const n of t){if(!e.includes(n))return!1;const t=a[n],r=b[n];if(V(t)&&V(r)){if(!F(t,r))return!1}else if(t!==r)return!1}for(const n of e)if(!t.includes(n))return!1;return!0}function V(t){return null!==t&&"object"==typeof t}function U(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach((t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function j(t){const e={};return t.replace(/^\?/,"").split("&").forEach((t=>{if(t){const[n,r]=t.split("=");e[decodeURIComponent(n)]=decodeURIComponent(r)}})),e}function B(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function $(t,e){const n=new z(t,e);return n.subscribe.bind(n)}class z{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((()=>{t(this)})).catch((t=>{this.error(t)}))}next(t){this.forEachObserver((e=>{e.next(t)}))}error(t){this.forEachObserver((e=>{e.error(t)})),this.close(t)}complete(){this.forEachObserver((t=>{t.complete()})),this.close()}subscribe(t,e,n){let r;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");r=function(t,e){if("object"!=typeof t||null===t)return!1;for(const n of e)if(n in t&&"function"==typeof t[n])return!0;return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n},void 0===r.next&&(r.next=K),void 0===r.error&&(r.error=K),void 0===r.complete&&(r.complete=K);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(t){}})),this.observers.push(r),o}unsubscribeOne(i){void 0!==this.observers&&void 0!==this.observers[i]&&(delete this.observers[i],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,t)}sendOne(i,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[i])try{t(this.observers[i])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function K(){}const G=1e3,H=2,Q=144e5,W=.5;function Y(t,e=G,n=H){const r=e*Math.pow(n,t),o=Math.round(W*r*(Math.random()-.5)*2);return Math.min(Q,r+o)}function X(t){return t&&t._delegate?t._delegate:t}}).call(this,n(42),n(185))},578:function(t,e,n){"use strict";n.d(e,"a",(function(){return G})),n.d(e,"b",(function(){return j})),n.d(e,"c",(function(){return U})),n.d(e,"d",(function(){return B})),n.d(e,"e",(function(){return Q})),n.d(e,"f",(function(){return H})),n.d(e,"g",(function(){return W}));var r=n(599),o=n(608),c=n(564);const h=(object,t)=>t.some((t=>object instanceof t));let l,d;const f=new WeakMap,m=new WeakMap,y=new WeakMap,v=new WeakMap,w=new WeakMap;let E={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return m.get(t);if("objectStoreNames"===e)return t.objectStoreNames||y.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return S(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function I(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(d||(d=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(C(this),e),S(f.get(this))}:function(...e){return S(t.apply(C(this),e))}:function(e,...n){const r=t.call(C(this),e,...n);return y.set(r,e.sort?e.sort():[e]),S(r)}}function T(t){return"function"==typeof t?I(t):(t instanceof IDBTransaction&&function(t){if(m.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",c),t.removeEventListener("abort",c)},o=()=>{e(),r()},c=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",o),t.addEventListener("error",c),t.addEventListener("abort",c)}));m.set(t,e)}(t),h(t,l||(l=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,E):t)}function S(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",o),t.removeEventListener("error",c)},o=()=>{e(S(t.result)),r()},c=()=>{n(t.error),r()};t.addEventListener("success",o),t.addEventListener("error",c)}));return e.then((e=>{e instanceof IDBCursor&&f.set(e,t)})).catch((()=>{})),w.set(e,t),e}(t);if(v.has(t))return v.get(t);const e=T(t);return e!==t&&(v.set(t,e),w.set(e,t)),e}const C=t=>w.get(t);const A=["get","getKey","getAll","getAllKeys","count"],_=["put","add","delete","clear"],D=new Map;function k(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(D.get(e))return D.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,o=_.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!A.includes(n))return;const c=async function(t,...e){const c=this.transaction(t,o?"readwrite":"readonly");let h=c.store;return r&&(h=h.index(e.shift())),(await Promise.all([h[n](...e),o&&c.done]))[0]};return D.set(e,c),c}E=(t=>({...t,get:(e,n,r)=>k(e,n)||t.get(e,n,r),has:(e,n)=>!!k(e,n)||t.has(e,n)}))(E);class N{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const component=t.getComponent();return"VERSION"===(null==component?void 0:component.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const O="@firebase/app",x="0.9.10",R=new o.b("@firebase/app"),M="[DEFAULT]",L={[O]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},P=new Map,F=new Map;function V(t,component){try{t.container.addComponent(component)}catch(e){R.debug(`Component ${component.name} failed to register with FirebaseApp ${t.name}`,e)}}function U(component){const t=component.name;if(F.has(t))return R.debug(`There were multiple attempts to register component ${t}.`),!1;F.set(t,component);for(const t of P.values())V(t,component);return!0}function j(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function B(t,e,n=M){j(t,e).clearInstance(n)}const $={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},z=new c.b("app","Firebase",$);class K{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.a("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw z.create("app-deleted",{appName:this._name})}}const G="9.22.0";function H(t,e={}){let n=t;if("object"!=typeof e){e={name:e}}const o=Object.assign({name:M,automaticDataCollectionEnabled:!1},e),h=o.name;if("string"!=typeof h||!h)throw z.create("bad-app-name",{appName:String(h)});if(n||(n=Object(c.l)()),!n)throw z.create("no-options");const l=P.get(h);if(l){if(Object(c.j)(n,l.options)&&Object(c.j)(o,l.config))return l;throw z.create("duplicate-app",{appName:h})}const d=new r.b(h);for(const component of F.values())d.addComponent(component);const f=new K(n,o,d);return P.set(h,f),f}function Q(t=M){const e=P.get(t);if(!e&&t===M&&Object(c.l)())return H();if(!e)throw z.create("no-app",{appName:t});return e}function W(t,e,n){var o;let c=null!==(o=L[t])&&void 0!==o?o:t;n&&(c+=`-${n}`);const h=c.match(/\s|\//),l=e.match(/\s|\//);if(h||l){const t=[`Unable to register library "${c}" with version "${e}":`];return h&&t.push(`library name "${c}" contains illegal characters (whitespace or "/")`),h&&l&&t.push("and"),l&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void R.warn(t.join(" "))}U(new r.a(`${c}-version`,(()=>({library:c,version:e})),"VERSION"))}const Y="firebase-heartbeat-database",X=1,J="firebase-heartbeat-store";let Z=null;function tt(){return Z||(Z=function(t,e,{blocked:n,upgrade:r,blocking:o,terminated:c}={}){const h=indexedDB.open(t,e),l=S(h);return r&&h.addEventListener("upgradeneeded",(t=>{r(S(h.result),t.oldVersion,t.newVersion,S(h.transaction),t)})),n&&h.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),l.then((t=>{c&&t.addEventListener("close",(()=>c())),o&&t.addEventListener("versionchange",(t=>o(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),l}(Y,X,{upgrade:(t,e)=>{if(0===e)t.createObjectStore(J)}}).catch((t=>{throw z.create("idb-open",{originalErrorMessage:t.message})}))),Z}async function et(t,e){try{const n=(await tt()).transaction(J,"readwrite"),r=n.objectStore(J);await r.put(e,nt(t)),await n.done}catch(t){if(t instanceof c.c)R.warn(t.message);else{const e=z.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});R.warn(e.message)}}}function nt(t){return`${t.name}!${t.options.appId}`}class it{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new ot(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=st();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=st(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let r=t.slice();for(const o of t){const t=n.find((t=>t.agent===o.agent));if(t){if(t.dates.push(o.date),at(n)>e){t.dates.pop();break}}else if(n.push({agent:o.agent,dates:[o.date]}),at(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=Object(c.f)(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function st(){return(new Date).toISOString().substring(0,10)}class ot{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!Object(c.u)()&&Object(c.A)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){return await async function(t){try{const e=await tt();return await e.transaction(J).objectStore(J).get(nt(t))}catch(t){if(t instanceof c.c)R.warn(t.message);else{const e=z.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});R.warn(e.message)}}}(this.app)||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return et(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return et(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function at(t){return Object(c.f)(JSON.stringify({version:2,heartbeats:t})).length}var ct;ct="",U(new r.a("platform-logger",(t=>new N(t)),"PRIVATE")),U(new r.a("heartbeat",(t=>new it(t)),"PRIVATE")),W(O,x,ct),W(O,x,"esm2017"),W("fire-js","")},599:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return l}));var r=n(564);class o{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const c="[DEFAULT]";class h{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new r.a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(component){if(component.name!==this.name)throw Error(`Mismatching Component ${component.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=component,this.shouldAutoInitialize()){if(function(component){return"EAGER"===component.instantiationMode}(component))try{this.getOrInitializeService({instanceIdentifier:c})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=c){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=c){return this.instances.has(t)}getOptions(t=c){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(t)&&e.resolve(r)}return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),o=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;o.add(t),this.onInitCallbacks.set(r,o);const c=this.instances.get(r);return c&&t(c,r),()=>{o.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===c?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=c){return this.component?this.component.multipleInstances?t:c:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class l{constructor(t){this.name=t,this.providers=new Map}addComponent(component){const t=this.getProvider(component.name);if(t.isComponentSet())throw new Error(`Component ${component.name} has already been registered with ${this.name}`);t.setComponent(component)}addOrOverwriteComponent(component){this.getProvider(component.name).isComponentSet()&&this.providers.delete(component.name),this.addComponent(component)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new h(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}},608:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return f})),n.d(e,"c",(function(){return m})),n.d(e,"d",(function(){return y}));const r=[];var o;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(o||(o={}));const c={debug:o.DEBUG,verbose:o.VERBOSE,info:o.INFO,warn:o.WARN,error:o.ERROR,silent:o.SILENT},h=o.INFO,l={[o.DEBUG]:"log",[o.VERBOSE]:"log",[o.INFO]:"info",[o.WARN]:"warn",[o.ERROR]:"error"},d=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),o=l[e];if(!o)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[o](`[${r}]  ${t.name}:`,...n)};class f{constructor(t){this.name=t,this._logLevel=h,this._logHandler=d,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in o))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?c[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,o.DEBUG,...t),this._logHandler(this,o.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,o.VERBOSE,...t),this._logHandler(this,o.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,o.INFO,...t),this._logHandler(this,o.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,o.WARN,...t),this._logHandler(this,o.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,o.ERROR,...t),this._logHandler(this,o.ERROR,...t)}}function m(t){r.forEach((e=>{e.setLogLevel(t)}))}function y(t,e){for(const n of r){let r=null;e&&e.level&&(r=c[e.level]),n.userLogHandler=null===t?null:(e,n,...c)=>{const h=c.map((t=>{if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}})).filter((t=>t)).join(" ");n>=(null!=r?r:e.logLevel)&&t({level:o[n].toLowerCase(),message:h,args:c,type:e.name})}}}},693:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return Si})),n.d(e,"b",(function(){return Ai})),n.d(e,"c",(function(){return Ci})),n.d(e,"d",(function(){return Di})),n.d(e,"e",(function(){return xi})),n.d(e,"f",(function(){return Oi})),n.d(e,"g",(function(){return _i})),n.d(e,"h",(function(){return ki})),n.d(e,"i",(function(){return Ni})),n.d(e,"j",(function(){return Ii})),n.d(e,"k",(function(){return Ti}));var r,o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},c={},h=h||{},l=o||self;function d(){}function f(a){var b=typeof a;return"array"==(b="object"!=b?b:a?Array.isArray(a)?"array":b:"null")||"object"==b&&"number"==typeof a.length}function p(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var m="closure_uid_"+(1e9*Math.random()>>>0),y=0;function v(a,b,t){return a.call.apply(a.bind,arguments)}function w(a,b,t){if(!a)throw Error();if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,e),a.apply(b,t)}}return function(){return a.apply(b,arguments)}}function q(a,b,t){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?v:w).apply(null,arguments)}function E(a,b){var t=Array.prototype.slice.call(arguments,1);return function(){var e=t.slice();return e.push.apply(e,arguments),a.apply(this,e)}}function I(a,b){function t(){}t.prototype=b.prototype,a.$=b.prototype,a.prototype=new t,a.prototype.constructor=a,a.ac=function(t,e,n){for(var r=Array(arguments.length-2),o=2;o<arguments.length;o++)r[o-2]=arguments[o];return b.prototype[e].apply(t,r)}}function T(){this.s=this.s,this.o=this.o}T.prototype.s=!1,T.prototype.ra=function(){var a;!this.s&&(this.s=!0,this.N(),0)&&(a=this,Object.prototype.hasOwnProperty.call(a,m)&&a[m]||(a[m]=++y))},T.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const S=Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b,void 0)}:function(a,b){if("string"==typeof a)return"string"!=typeof b||1!=b.length?-1:a.indexOf(b,0);for(let t=0;t<a.length;t++)if(t in a&&a[t]===b)return t;return-1};function C(a){const b=a.length;if(0<b){const t=Array(b);for(let e=0;e<b;e++)t[e]=a[e];return t}return[]}function A(a,b){for(let t=1;t<arguments.length;t++){const e=arguments[t];if(f(e)){const t=a.length||0,n=e.length||0;a.length=t+n;for(let r=0;r<n;r++)a[t+r]=e[r]}else a.push(e)}}function _(a,b){this.type=a,this.g=this.target=b,this.defaultPrevented=!1}_.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});try{l.addEventListener("test",d,b),l.removeEventListener("test",d,b)}catch(t){}return a}();function k(a){return/^[\s\xa0]*$/.test(a)}var N=String.prototype.trim?function(a){return a.trim()}:function(a){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(a)[1]};function O(a,b){return a<b?-1:a>b?1:0}function x(){var a=l.navigator;return a&&(a=a.userAgent)?a:""}function R(a){return-1!=x().indexOf(a)}function M(a){return M[" "](a),a}function L(a,b,t){return Object.prototype.hasOwnProperty.call(a,b)?a[b]:a[b]=t(b)}M[" "]=d;var P,a,F=R("Opera"),V=R("Trident")||R("MSIE"),U=R("Edge"),j=U||V,B=R("Gecko")&&!(-1!=x().toLowerCase().indexOf("webkit")&&!R("Edge"))&&!(R("Trident")||R("MSIE"))&&!R("Edge"),$=-1!=x().toLowerCase().indexOf("webkit")&&!R("Edge");function z(){var a=l.document;return a?a.documentMode:void 0}t:{var K="",G=(a=x(),B?/rv:([^\);]+)(\)|;)/.exec(a):U?/Edge\/([\d\.]+)/.exec(a):V?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):$?/WebKit\/(\S+)/.exec(a):F?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if(G&&(K=G?G[1]:""),V){var H=z();if(null!=H&&H>parseFloat(K)){P=String(H);break t}}P=K}var Q,W={};if(l.document&&V){var Y=z();Q=Y||(parseInt(P,10)||void 0)}else Q=void 0;var X=Q;function J(a,b){if(_.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var t=this.type=a.type,e=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=b,b=a.relatedTarget){if(B){t:{try{M(b.nodeName);var n=!0;break t}catch(t){}n=!1}n||(b=null)}}else"mouseover"==t?b=a.fromElement:"mouseout"==t&&(b=a.toElement);this.relatedTarget=b,e?(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0):(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType="string"==typeof a.pointerType?a.pointerType:Z[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&J.$.h.call(this)}}I(J,_);var Z={2:"touch",3:"pen",4:"mouse"};J.prototype.h=function(){J.$.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var tt="closure_listenable_"+(1e6*Math.random()|0),et=0;function nt(a,b,t,e,n){this.listener=a,this.proxy=null,this.src=b,this.type=t,this.capture=!!e,this.la=n,this.key=++et,this.fa=this.ia=!1}function it(a){a.fa=!0,a.listener=null,a.proxy=null,a.src=null,a.la=null}function st(a,b,t){for(const e in a)b.call(t,a[e],e,a)}function ot(a){const b={};for(const t in a)b[t]=a[t];return b}const at="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ct(a,b){let t,e;for(let n=1;n<arguments.length;n++){for(t in e=arguments[n],e)a[t]=e[t];for(let n=0;n<at.length;n++)t=at[n],Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t])}}function ut(a){this.src=a,this.g={},this.h=0}function ht(a,b){var t=b.type;if(t in a.g){var e,n=a.g[t],r=S(n,b);(e=0<=r)&&Array.prototype.splice.call(n,r,1),e&&(it(b),0==a.g[t].length&&(delete a.g[t],a.h--))}}function lt(a,b,t,e){for(var n=0;n<a.length;++n){var r=a[n];if(!r.fa&&r.listener==b&&r.capture==!!t&&r.la==e)return n}return-1}ut.prototype.add=function(a,b,t,e,n){var r=a.toString();(a=this.g[r])||(a=this.g[r]=[],this.h++);var o=lt(a,b,e,n);return-1<o?(b=a[o],t||(b.ia=!1)):((b=new nt(b,this.src,r,!!e,n)).ia=t,a.push(b)),b};var ft="closure_lm_"+(1e6*Math.random()|0),pt={};function gt(a,b,t,e,n){if(e&&e.once)return yt(a,b,t,e,n);if(Array.isArray(b)){for(var r=0;r<b.length;r++)gt(a,b[r],t,e,n);return null}return t=St(t),a&&a[tt]?a.O(b,t,p(e)?!!e.capture:!!e,n):mt(a,b,t,!1,e,n)}function mt(a,b,t,e,n,r){if(!b)throw Error("Invalid event type");var o=p(n)?!!n.capture:!!n,c=It(a);if(c||(a[ft]=c=new ut(a)),(t=c.add(b,t,e,o,r)).proxy)return t;if(e=function(){function a(t){return b.call(a.src,a.listener,t)}const b=Et;return a}(),t.proxy=e,e.src=a,e.listener=t,a.addEventListener)D||(n=o),void 0===n&&(n=!1),a.addEventListener(b.toString(),e,n);else if(a.attachEvent)a.attachEvent(bt(b.toString()),e);else{if(!a.addListener||!a.removeListener)throw Error("addEventListener and attachEvent are unavailable.");a.addListener(e)}return t}function yt(a,b,t,e,n){if(Array.isArray(b)){for(var r=0;r<b.length;r++)yt(a,b[r],t,e,n);return null}return t=St(t),a&&a[tt]?a.P(b,t,p(e)?!!e.capture:!!e,n):mt(a,b,t,!0,e,n)}function vt(a,b,t,e,n){if(Array.isArray(b))for(var r=0;r<b.length;r++)vt(a,b[r],t,e,n);else e=p(e)?!!e.capture:!!e,t=St(t),a&&a[tt]?(a=a.i,(b=String(b).toString())in a.g&&(-1<(t=lt(r=a.g[b],t,e,n))&&(it(r[t]),Array.prototype.splice.call(r,t,1),0==r.length&&(delete a.g[b],a.h--)))):a&&(a=It(a))&&(b=a.g[b.toString()],a=-1,b&&(a=lt(b,t,e,n)),(t=-1<a?b[a]:null)&&wt(t))}function wt(a){if("number"!=typeof a&&a&&!a.fa){var b=a.src;if(b&&b[tt])ht(b.i,a);else{var t=a.type,e=a.proxy;b.removeEventListener?b.removeEventListener(t,e,a.capture):b.detachEvent?b.detachEvent(bt(t),e):b.addListener&&b.removeListener&&b.removeListener(e),(t=It(b))?(ht(t,a),0==t.h&&(t.src=null,b[ft]=null)):it(a)}}}function bt(a){return a in pt?pt[a]:pt[a]="on"+a}function Et(a,b){if(a.fa)a=!0;else{b=new J(b,this);var t=a.listener,e=a.la||a.src;a.ia&&wt(a),a=t.call(e,b)}return a}function It(a){return(a=a[ft])instanceof ut?a:null}var Tt="__closure_events_fn_"+(1e9*Math.random()>>>0);function St(a){return"function"==typeof a?a:(a[Tt]||(a[Tt]=function(b){return a.handleEvent(b)}),a[Tt])}function Ct(){T.call(this),this.i=new ut(this),this.S=this,this.J=null}function At(a,b){var t,e=a.J;if(e)for(t=[];e;e=e.J)t.push(e);if(a=a.S,e=b.type||b,"string"==typeof b)b=new _(b,a);else if(b instanceof _)b.target=b.target||a;else{var n=b;ct(b=new _(e,a),n)}if(n=!0,t)for(var r=t.length-1;0<=r;r--){var o=b.g=t[r];n=_t(o,e,!0,b)&&n}if(n=_t(o=b.g=a,e,!0,b)&&n,n=_t(o,e,!1,b)&&n,t)for(r=0;r<t.length;r++)n=_t(o=b.g=t[r],e,!1,b)&&n}function _t(a,b,t,e){if(!(b=a.i.g[String(b)]))return!0;b=b.concat();for(var n=!0,r=0;r<b.length;++r){var o=b[r];if(o&&!o.fa&&o.capture==t){var c=o.listener,h=o.la||o.src;o.ia&&ht(a.i,o),n=!1!==c.call(h,e)&&n}}return n&&!e.defaultPrevented}I(Ct,T),Ct.prototype[tt]=!0,Ct.prototype.removeEventListener=function(a,b,t,e){vt(this,a,b,t,e)},Ct.prototype.N=function(){if(Ct.$.N.call(this),this.i){var t,a=this.i;for(t in a.g){for(var e=a.g[t],n=0;n<e.length;n++)it(e[n]);delete a.g[t],a.h--}}this.J=null},Ct.prototype.O=function(a,b,t,e){return this.i.add(String(a),b,!1,t,e)},Ct.prototype.P=function(a,b,t,e){return this.i.add(String(a),b,!0,t,e)};var Dt=l.JSON.stringify;function kt(){var a=Pt;let b=null;return a.g&&(b=a.g,a.g=a.g.next,a.g||(a.h=null),b.next=null),b}var Nt,Ot=new class{constructor(a,b){this.i=a,this.j=b,this.h=0,this.g=null}get(){let a;return 0<this.h?(this.h--,a=this.g,this.g=a.next,a.next=null):a=this.i(),a}}((()=>new xt),(a=>a.reset()));class xt{constructor(){this.next=this.g=this.h=null}set(a,b){this.h=a,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}function Rt(a){l.setTimeout((()=>{throw a}),0)}function Mt(a,b){Nt||function(){var a=l.Promise.resolve(void 0);Nt=function(){a.then(Ft)}}(),Lt||(Nt(),Lt=!0),Pt.add(a,b)}var Lt=!1,Pt=new class{constructor(){this.h=this.g=null}add(a,b){const t=Ot.get();t.set(a,b),this.h?this.h.next=t:this.g=t,this.h=t}};function Ft(){for(var a;a=kt();){try{a.h.call(a.g)}catch(t){Rt(t)}var b=Ot;b.j(a),100>b.h&&(b.h++,a.next=b.g,b.g=a)}Lt=!1}function Vt(a,b){Ct.call(this),this.h=a||1,this.g=b||l,this.j=q(this.qb,this),this.l=Date.now()}function Ut(a){a.ga=!1,a.T&&(a.g.clearTimeout(a.T),a.T=null)}function jt(a,b,t){if("function"==typeof a)t&&(a=q(a,t));else{if(!a||"function"!=typeof a.handleEvent)throw Error("Invalid listener argument");a=q(a.handleEvent,a)}return 2147483647<Number(b)?-1:l.setTimeout(a,b||0)}function Bt(a){a.g=jt((()=>{a.g=null,a.i&&(a.i=!1,Bt(a))}),a.j);const b=a.h;a.h=null,a.m.apply(null,b)}I(Vt,Ct),(r=Vt.prototype).ga=!1,r.T=null,r.qb=function(){if(this.ga){var a=Date.now()-this.l;0<a&&a<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-a):(this.T&&(this.g.clearTimeout(this.T),this.T=null),At(this,"tick"),this.ga&&(Ut(this),this.start()))}},r.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.N=function(){Vt.$.N.call(this),Ut(this),delete this.g};class qt extends T{constructor(a,b){super(),this.m=a,this.j=b,this.h=null,this.i=!1,this.g=null}l(a){this.h=arguments,this.g?this.i=!0:Bt(this)}N(){super.N(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function $t(a){T.call(this),this.h=a,this.g={}}I($t,T);var zt=[];function Kt(a,b,t,e){Array.isArray(t)||(t&&(zt[0]=t.toString()),t=zt);for(var n=0;n<t.length;n++){var r=gt(b,t[n],e||a.handleEvent,!1,a.h||a);if(!r)break;a.g[r.key]=r}}function Gt(a){st(a.g,(function(b,t){this.g.hasOwnProperty(t)&&wt(b)}),a),a.g={}}function Ht(){this.g=!0}function Qt(a,b,t,e){a.info((function(){return"XMLHTTP TEXT ("+b+"): "+function(a,b){if(!a.g)return b;if(!b)return null;try{var t=JSON.parse(b);if(t)for(a=0;a<t.length;a++)if(Array.isArray(t[a])){var e=t[a];if(!(2>e.length)){var n=e[1];if(Array.isArray(n)&&!(1>n.length)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<n.length;o++)n[o]=""}}}return Dt(t)}catch(t){return b}}(a,t)+(e?" "+e:"")}))}$t.prototype.N=function(){$t.$.N.call(this),Gt(this)},$t.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ht.prototype.Ea=function(){this.g=!1},Ht.prototype.info=function(){};var Wt={},Yt=null;function Xt(){return Yt=Yt||new Ct}function Jt(a){_.call(this,Wt.Ta,a)}function Zt(a){const b=Xt();At(b,new Jt(b))}function te(a,b){_.call(this,Wt.STAT_EVENT,a),this.stat=b}function ee(a){const b=Xt();At(b,new te(b,a))}function ne(a,b){_.call(this,Wt.Ua,a),this.size=b}function ie(a,b){if("function"!=typeof a)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){a()}),b)}Wt.Ta="serverreachability",I(Jt,_),Wt.STAT_EVENT="statevent",I(te,_),Wt.Ua="timingevent",I(ne,_);var re={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},se={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function oe(){}function ae(a){return a.h||(a.h=a.i())}function ce(){}oe.prototype.h=null;var ue,he={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function le(){_.call(this,"d")}function de(){_.call(this,"c")}function fe(){}function pe(a,b,t,e){this.l=a,this.j=b,this.m=t,this.W=e||1,this.U=new $t(this),this.P=me,a=j?125:void 0,this.V=new Vt(a),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.aa=-1,this.J=!1,this.O=0,this.M=null,this.ca=this.K=this.ba=this.S=!1,this.h=new ge}function ge(){this.i=null,this.g="",this.h=!1}I(le,_),I(de,_),I(fe,oe),fe.prototype.g=function(){return new XMLHttpRequest},fe.prototype.i=function(){return{}},ue=new fe;var me=45e3,ye={},ve={};function we(a,b,t){a.L=1,a.v=Ve(Re(b)),a.s=t,a.S=!0,be(a,null)}function be(a,b){a.G=Date.now(),Se(a),a.A=Re(a.v);var t=a.A,e=a.W;Array.isArray(e)||(e=[String(e)]),Xe(t.i,"t",e),a.C=0,t=a.l.I,a.h=new ge,a.g=Wn(a.l,t?b:null,!a.s),0<a.O&&(a.M=new qt(q(a.Pa,a,a.g),a.O)),Kt(a.U,a.g,"readystatechange",a.nb),b=a.I?ot(a.I):{},a.s?(a.u||(a.u="POST"),b["Content-Type"]="application/x-www-form-urlencoded",a.g.ha(a.A,a.u,a.s,b)):(a.u="GET",a.g.ha(a.A,a.u,null,b)),Zt(),function(a,b,t,e,n,r){a.info((function(){if(a.g)if(r)for(var o="",c=r.split("&"),h=0;h<c.length;h++){var l=c[h].split("=");if(1<l.length){var u=l[0];l=l[1];var d=u.split("_");o=2<=d.length&&"type"==d[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+e+") [attempt "+n+"]: "+b+"\n"+t+"\n"+o}))}(a.j,a.u,a.A,a.m,a.W,a.s)}function Ee(a){return!!a.g&&("GET"==a.u&&2!=a.L&&a.l.Ha)}function Ie(a,b,t){let e,n=!0;for(;!a.J&&a.C<t.length;){if(e=Te(a,t),e==ve){4==b&&(a.o=4,ee(14),n=!1),Qt(a.j,a.m,null,"[Incomplete Response]");break}if(e==ye){a.o=4,ee(15),Qt(a.j,a.m,t,"[Invalid Chunk]"),n=!1;break}Qt(a.j,a.m,e,null),ke(a,e)}Ee(a)&&e!=ve&&e!=ye&&(a.h.g="",a.C=0),4!=b||0!=t.length||a.h.h||(a.o=1,ee(16),n=!1),a.i=a.i&&n,n?0<t.length&&!a.ca&&(a.ca=!0,(b=a.l).g==a&&b.ca&&!b.L&&(b.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),Bn(b),b.L=!0,ee(11))):(Qt(a.j,a.m,t,"[Invalid Chunked Response]"),De(a),_e(a))}function Te(a,b){var t=a.C,e=b.indexOf("\n",t);return-1==e?ve:(t=Number(b.substring(t,e)),isNaN(t)?ye:(e+=1)+t>b.length?ve:(b=b.substr(e,t),a.C=e+t,b))}function Se(a){a.Y=Date.now()+a.P,Ce(a,a.P)}function Ce(a,b){if(null!=a.B)throw Error("WatchDog timer not null");a.B=ie(q(a.lb,a),b)}function Ae(a){a.B&&(l.clearTimeout(a.B),a.B=null)}function _e(a){0==a.l.H||a.J||zn(a.l,a)}function De(a){Ae(a);var b=a.M;b&&"function"==typeof b.ra&&b.ra(),a.M=null,Ut(a.V),Gt(a.U),a.g&&(b=a.g,a.g=null,b.abort(),b.ra())}function ke(a,b){try{var t=a.l;if(0!=t.H&&(t.g==a||nn(t.h,a)))if(!a.K&&nn(t.h,a)&&3==t.H){try{var e=t.Ja.g.parse(b)}catch(t){e=null}if(Array.isArray(e)&&3==e.length){var n=e;if(0==n[0]){t:if(!t.u){if(t.g){if(!(t.g.G+3e3<a.G))break t;$n(t),Rn(t)}jn(t),ee(18)}}else t.Fa=n[1],0<t.Fa-t.V&&37500>n[2]&&t.M&&0==t.A&&!t.v&&(t.v=ie(q(t.ib,t),6e3));if(1>=en(t.h)&&t.na){try{t.na()}catch(t){}t.na=void 0}}else Gn(t,11)}else if((a.K||t.g==a)&&$n(t),!k(b))for(n=t.Ja.g.parse(b),b=0;b<n.length;b++){let l=n[b];if(t.V=l[0],l=l[1],2==t.H)if("c"==l[0]){t.J=l[1],t.oa=l[2];const u=l[3];null!=u&&(t.qa=u,t.j.info("VER="+t.qa));const n=l[4];null!=n&&(t.Ga=n,t.j.info("SVER="+t.Ga));const d=l[5];null!=d&&"number"==typeof d&&0<d&&(e=1.5*d,t.K=e,t.j.info("backChannelRequestTimeoutMs_="+e)),e=t;const f=a.g;if(f){const t=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var r=e.h;r.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(rn(r,r.h),r.h=null))}if(e.F){const t=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(e.Da=t,Fe(e.G,e.F,t))}}t.H=3,t.l&&t.l.Ba(),t.ca&&(t.S=Date.now()-a.G,t.j.info("Handshake RTT: "+t.S+"ms"));var o=a;if((e=t).wa=Qn(e,e.I?e.oa:null,e.Y),o.K){sn(e.h,o);var c=o,h=e.K;h&&c.setTimeout(h),c.B&&(Ae(c),Se(c)),e.g=o}else Un(e);0<t.i.length&&Ln(t)}else"stop"!=l[0]&&"close"!=l[0]||Gn(t,7);else 3==t.H&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?Gn(t,7):xn(t):"noop"!=l[0]&&t.l&&t.l.Aa(l),t.A=0)}Zt()}catch(t){}}function Ne(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(f(a)||"string"==typeof a)Array.prototype.forEach.call(a,b,void 0);else for(var t=function(a){if(a.sa&&"function"==typeof a.sa)return a.sa();if(!a.Z||"function"!=typeof a.Z){if("undefined"!=typeof Map&&a instanceof Map)return Array.from(a.keys());if(!("undefined"!=typeof Set&&a instanceof Set)){if(f(a)||"string"==typeof a){var b=[];a=a.length;for(var t=0;t<a;t++)b.push(t);return b}b=[],t=0;for(const e in a)b[t++]=e;return b}}}(a),e=function(a){if(a.Z&&"function"==typeof a.Z)return a.Z();if("undefined"!=typeof Map&&a instanceof Map||"undefined"!=typeof Set&&a instanceof Set)return Array.from(a.values());if("string"==typeof a)return a.split("");if(f(a)){for(var b=[],t=a.length,e=0;e<t;e++)b.push(a[e]);return b}for(e in b=[],t=0,a)b[t++]=a[e];return b}(a),n=e.length,r=0;r<n;r++)b.call(void 0,e[r],t&&t[r],a)}(r=pe.prototype).setTimeout=function(a){this.P=a},r.nb=function(a){a=a.target;const b=this.M;b&&3==An(a)?b.l():this.Pa(a)},r.Pa=function(a){try{if(a==this.g)t:{const u=An(this.g);var b=this.g.Ia();this.g.da();if(!(3>u)&&(3!=u||j||this.g&&(this.h.h||this.g.ja()||_n(this.g)))){this.J||4!=u||7==b||Zt(),Ae(this);var t=this.g.da();this.aa=t;e:if(Ee(this)){var e=_n(this.g);a="";var n=e.length,r=4==An(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){De(this),_e(this);var o="";break e}this.h.i=new l.TextDecoder}for(b=0;b<n;b++)this.h.h=!0,a+=this.h.i.decode(e[b],{stream:r&&b==n-1});e.splice(0,n),this.h.g+=a,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function(a,b,t,e,n,r,o){a.info((function(){return"XMLHTTP RESP ("+e+") [ attempt "+n+"]: "+b+"\n"+t+"\n"+r+" "+o}))}(this.j,this.u,this.A,this.m,this.W,u,t),this.i){if(this.ba&&!this.K){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(c)){var d=c;break e}}d=null}if(!(t=d)){this.i=!1,this.o=3,ee(12),De(this),_e(this);break t}Qt(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ke(this,t)}this.S?(Ie(this,u,o),j&&this.i&&3==u&&(Kt(this.U,this.V,"tick",this.mb),this.V.start())):(Qt(this.j,this.m,o,null),ke(this,o)),4==u&&De(this),this.i&&!this.J&&(4==u?zn(this.l,this):(this.i=!1,Se(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,ee(12)):(this.o=0,ee(13)),De(this),_e(this)}}}catch(t){}},r.mb=function(){if(this.g){var a=An(this.g),b=this.g.ja();this.C<b.length&&(Ae(this),Ie(this,a,b),this.i&&4!=a&&Se(this))}},r.cancel=function(){this.J=!0,De(this)},r.lb=function(){this.B=null;const a=Date.now();0<=a-this.Y?(function(a,b){a.info((function(){return"TIMEOUT: "+b}))}(this.j,this.A),2!=this.L&&(Zt(),ee(17)),De(this),this.o=2,_e(this)):Ce(this,this.Y-a)};var Oe=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function xe(a,b){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,a instanceof xe){this.h=void 0!==b?b:a.h,Me(this,a.j),this.s=a.s,this.g=a.g,Le(this,a.m),this.l=a.l,b=a.i;var t=new He;t.i=b.i,b.g&&(t.g=new Map(b.g),t.h=b.h),Pe(this,t),this.o=a.o}else a&&(t=String(a).match(Oe))?(this.h=!!b,Me(this,t[1]||"",!0),this.s=Ue(t[2]||""),this.g=Ue(t[3]||"",!0),Le(this,t[4]),this.l=Ue(t[5]||"",!0),Pe(this,t[6]||"",!0),this.o=Ue(t[7]||"")):(this.h=!!b,this.i=new He(null,this.h))}function Re(a){return new xe(a)}function Me(a,b,t){a.j=t?Ue(b,!0):b,a.j&&(a.j=a.j.replace(/:$/,""))}function Le(a,b){if(b){if(b=Number(b),isNaN(b)||0>b)throw Error("Bad port number "+b);a.m=b}else a.m=null}function Pe(a,b,t){b instanceof He?(a.i=b,function(a,b){b&&!a.j&&(Qe(a),a.i=null,a.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(We(this,e),Xe(this,n,t))}),a)),a.j=b}(a.i,a.h)):(t||(b=je(b,Ke)),a.i=new He(b,a.h))}function Fe(a,b,t){a.i.set(b,t)}function Ve(a){return Fe(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Ue(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function je(a,b,t){return"string"==typeof a?(a=encodeURI(a).replace(b,Be),t&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Be(a){return"%"+((a=a.charCodeAt(0))>>4&15).toString(16)+(15&a).toString(16)}xe.prototype.toString=function(){var a=[],b=this.j;b&&a.push(je(b,qe,!0),":");var t=this.g;return(t||"file"==b)&&(a.push("//"),(b=this.s)&&a.push(je(b,qe,!0),"@"),a.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&a.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&a.push("/"),a.push(je(t,"/"==t.charAt(0)?ze:$e,!0))),(t=this.i.toString())&&a.push("?",t),(t=this.o)&&a.push("#",je(t,Ge)),a.join("")};var qe=/[#\/\?@]/g,$e=/[#\?:]/g,ze=/[#\?]/g,Ke=/[#\?@]/g,Ge=/#/g;function He(a,b){this.h=this.g=null,this.i=a||null,this.j=!!b}function Qe(a){a.g||(a.g=new Map,a.h=0,a.i&&function(a,b){if(a){a=a.split("&");for(var t=0;t<a.length;t++){var e=a[t].indexOf("="),n=null;if(0<=e){var r=a[t].substring(0,e);n=a[t].substring(e+1)}else r=a[t];b(r,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(a.i,(function(b,t){a.add(decodeURIComponent(b.replace(/\+/g," ")),t)})))}function We(a,b){Qe(a),b=Je(a,b),a.g.has(b)&&(a.i=null,a.h-=a.g.get(b).length,a.g.delete(b))}function Ye(a,b){return Qe(a),b=Je(a,b),a.g.has(b)}function Xe(a,b,t){We(a,b),0<t.length&&(a.i=null,a.g.set(Je(a,b),C(t)),a.h+=t.length)}function Je(a,b){return b=String(b),a.j&&(b=b.toLowerCase()),b}(r=He.prototype).add=function(a,b){Qe(this),this.i=null,a=Je(this,a);var t=this.g.get(a);return t||this.g.set(a,t=[]),t.push(b),this.h+=1,this},r.forEach=function(a,b){Qe(this),this.g.forEach((function(t,e){t.forEach((function(t){a.call(b,t,e,this)}),this)}),this)},r.sa=function(){Qe(this);const a=Array.from(this.g.values()),b=Array.from(this.g.keys()),t=[];for(let e=0;e<b.length;e++){const n=a[e];for(let r=0;r<n.length;r++)t.push(b[e])}return t},r.Z=function(a){Qe(this);let b=[];if("string"==typeof a)Ye(this,a)&&(b=b.concat(this.g.get(Je(this,a))));else{a=Array.from(this.g.values());for(let t=0;t<a.length;t++)b=b.concat(a[t])}return b},r.set=function(a,b){return Qe(this),this.i=null,Ye(this,a=Je(this,a))&&(this.h-=this.g.get(a).length),this.g.set(a,[b]),this.h+=1,this},r.get=function(a,b){return a&&0<(a=this.Z(a)).length?String(a[0]):b},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const a=[],b=Array.from(this.g.keys());for(var t=0;t<b.length;t++){var e=b[t];const r=encodeURIComponent(String(e)),o=this.Z(e);for(e=0;e<o.length;e++){var n=r;""!==o[e]&&(n+="="+encodeURIComponent(String(o[e]))),a.push(n)}}return this.i=a.join("&")};function dd(a){this.l=a||Ze,l.PerformanceNavigationTiming?a=0<(a=l.performance.getEntriesByType("navigation")).length&&("hq"==a[0].nextHopProtocol||"h2"==a[0].nextHopProtocol):a=!!(l.g&&l.g.Ka&&l.g.Ka()&&l.g.Ka().ec),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Ze=10;function tn(a){return!!a.h||!!a.g&&a.g.size>=a.j}function en(a){return a.h?1:a.g?a.g.size:0}function nn(a,b){return a.h?a.h==b:!!a.g&&a.g.has(b)}function rn(a,b){a.g?a.g.add(b):a.h=b}function sn(a,b){a.h&&a.h==b?a.h=null:a.g&&a.g.has(b)&&a.g.delete(b)}function on(a){if(null!=a.h)return a.i.concat(a.h.F);if(null!=a.g&&0!==a.g.size){let b=a.i;for(const t of a.g.values())b=b.concat(t.F);return b}return C(a.i)}function an(){}function cn(){this.g=new an}function un(a,b,t){const e=t||"";try{Ne(a,(function(t,n){let r=t;p(t)&&(r=Dt(t)),b.push(e+n+"="+encodeURIComponent(r))}))}catch(t){throw b.push(e+"type="+encodeURIComponent("_badmap")),t}}function hn(a,b,t,e,n){try{b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null,n(e)}catch(t){}}function ln(a){this.l=a.fc||null,this.j=a.ob||!1}function dn(a,b){Ct.call(this),this.F=a,this.u=b,this.m=void 0,this.readyState=fn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}dd.prototype.cancel=function(){if(this.i=on(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const a of this.g.values())a.cancel();this.g.clear()}},an.prototype.stringify=function(a){return l.JSON.stringify(a,void 0)},an.prototype.parse=function(a){return l.JSON.parse(a,void 0)},I(ln,oe),ln.prototype.g=function(){return new dn(this.l,this.j)},ln.prototype.i=function(a){return function(){return a}}({}),I(dn,Ct);var fn=0;function pn(a){a.j.read().then(a.Xa.bind(a)).catch(a.ka.bind(a))}function gn(a){a.readyState=4,a.l=null,a.j=null,a.A=null,mn(a)}function mn(a){a.onreadystatechange&&a.onreadystatechange.call(a)}(r=dn.prototype).open=function(a,b){if(this.readyState!=fn)throw this.abort(),Error("Error reopening a connection");this.C=a,this.B=b,this.readyState=1,mn(this)},r.send=function(a){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const b={headers:this.v,method:this.C,credentials:this.m,cache:void 0};a&&(b.body=a),(this.F||l).fetch(new Request(this.B,b)).then(this.$a.bind(this),this.ka.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,gn(this)),this.readyState=fn},r.$a=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,mn(this)),this.g&&(this.readyState=3,mn(this),this.g)))if("arraybuffer"===this.responseType)a.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==l.ReadableStream&&"body"in a){if(this.j=a.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;pn(this)}else a.text().then(this.Za.bind(this),this.ka.bind(this))},r.Xa=function(a){if(this.g){if(this.u&&a.value)this.response.push(a.value);else if(!this.u){var b=a.value?a.value:new Uint8Array(0);(b=this.A.decode(b,{stream:!a.done}))&&(this.response=this.responseText+=b)}a.done?gn(this):mn(this),3==this.readyState&&pn(this)}},r.Za=function(a){this.g&&(this.response=this.responseText=a,gn(this))},r.Ya=function(a){this.g&&(this.response=a,gn(this))},r.ka=function(){this.g&&gn(this)},r.setRequestHeader=function(a,b){this.v.append(a,b)},r.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const a=[],b=this.h.entries();for(var t=b.next();!t.done;)t=t.value,a.push(t[0]+": "+t[1]),t=b.next();return a.join("\r\n")},Object.defineProperty(dn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(a){this.m=a?"include":"same-origin"}});var yn=l.JSON.parse;function vn(a){Ct.call(this),this.headers=new Map,this.u=a||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=td,this.L=this.M=!1}I(vn,Ct);var td="",wn=/^https?$/i,bn=["POST","PUT"];function En(a,b){a.h=!1,a.g&&(a.l=!0,a.g.abort(),a.l=!1),a.j=b,a.m=5,In(a),Sn(a)}function In(a){a.F||(a.F=!0,At(a,"complete"),At(a,"error"))}function Tn(a){if(a.h&&void 0!==h&&(!a.C[1]||4!=An(a)||2!=a.da()))if(a.v&&4==An(a))jt(a.La,0,a);else if(At(a,"readystatechange"),4==An(a)){a.h=!1;try{const c=a.da();t:switch(c){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break t;default:b=!1}var t;if(!(t=b)){var e;if(e=0===c){var n=String(a.I).match(Oe)[1]||null;if(!n&&l.self&&l.self.location){var r=l.self.location.protocol;n=r.substr(0,r.length-1)}e=!wn.test(n?n.toLowerCase():"")}t=e}if(t)At(a,"complete"),At(a,"success");else{a.m=6;try{var o=2<An(a)?a.g.statusText:""}catch(t){o=""}a.j=o+" ["+a.da()+"]",In(a)}}finally{Sn(a)}}}function Sn(a,b){if(a.g){Cn(a);const t=a.g,e=a.C[0]?d:null;a.g=null,a.C=null,b||At(a,"ready");try{t.onreadystatechange=e}catch(t){}}}function Cn(a){a.g&&a.L&&(a.g.ontimeout=null),a.A&&(l.clearTimeout(a.A),a.A=null)}function An(a){return a.g?a.g.readyState:0}function _n(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.K){case td:case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Dn(a){let b="";return st(a,(function(t,e){b+=e,b+=":",b+=t,b+="\r\n"})),b}function kn(a,b,t){t:{for(e in t){var e=!1;break t}e=!0}e||(t=Dn(t),"string"==typeof a?null!=t&&encodeURIComponent(String(t)):Fe(a,b,t))}function Nn(a,b,t){return t&&t.internalChannelParams&&t.internalChannelParams[a]||b}function On(a){this.Ga=0,this.i=[],this.j=new Ht,this.oa=this.wa=this.G=this.Y=this.g=this.Da=this.F=this.ma=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Nn("failFast",!1,a),this.M=this.v=this.u=this.m=this.l=null,this.aa=!0,this.ta=this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Nn("baseRetryDelayMs",5e3,a),this.hb=Nn("retryDelaySeedMs",1e4,a),this.eb=Nn("forwardChannelMaxRetries",2,a),this.xa=Nn("forwardChannelRequestTimeoutMs",2e4,a),this.va=a&&a.xmlHttpFactory||void 0,this.Ha=a&&a.dc||!1,this.K=void 0,this.I=a&&a.supportsCrossDomainXhr||!1,this.J="",this.h=new dd(a&&a.concurrentRequestLimit),this.Ja=new cn,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=a&&a.bc||!1,a&&a.Ea&&this.j.Ea(),a&&a.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&a&&a.detectBufferingProxy||!1,this.na=void 0,this.S=0,this.L=!1,this.pa=this.B=null}function xn(a){if(Mn(a),3==a.H){var b=a.W++,t=Re(a.G);Fe(t,"SID",a.J),Fe(t,"RID",b),Fe(t,"TYPE","terminate"),Fn(a,t),(b=new pe(a,a.j,b,void 0)).L=2,b.v=Ve(Re(t)),t=!1,l.navigator&&l.navigator.sendBeacon&&(t=l.navigator.sendBeacon(b.v.toString(),"")),!t&&l.Image&&((new Image).src=b.v,t=!0),t||(b.g=Wn(b.l,null),b.g.ha(b.v)),b.G=Date.now(),Se(b)}Hn(a)}function Rn(a){a.g&&(Bn(a),a.g.cancel(),a.g=null)}function Mn(a){Rn(a),a.u&&(l.clearTimeout(a.u),a.u=null),$n(a),a.h.cancel(),a.m&&("number"==typeof a.m&&l.clearTimeout(a.m),a.m=null)}function Ln(a){tn(a.h)||a.m||(a.m=!0,Mt(a.Na,a),a.C=0)}function Pn(a,b){var t;t=b?b.m:a.W++;const e=Re(a.G);Fe(e,"SID",a.J),Fe(e,"RID",t),Fe(e,"AID",a.V),Fn(a,e),a.o&&a.s&&kn(e,a.o,a.s),t=new pe(a,a.j,t,a.C+1),null===a.o&&(t.I=a.s),b&&(a.i=b.F.concat(a.i)),b=Vn(a,t,1e3),t.setTimeout(Math.round(.5*a.xa)+Math.round(.5*a.xa*Math.random())),rn(a.h,t),we(t,e,b)}function Fn(a,b){a.ma&&st(a.ma,(function(t,e){Fe(b,e,t)})),a.l&&Ne({},(function(t,e){Fe(b,e,t)}))}function Vn(a,b,t){t=Math.min(a.i.length,t);var e=a.l?q(a.l.Va,a.l,a):null;t:{var n=a.i;let r=-1;for(;;){const o=["count="+t];-1==r?0<t?(r=n[0].h,o.push("ofs="+r)):r=0:o.push("ofs="+r);let c=!0;for(let h=0;h<t;h++){let t=n[h].h;const u=n[h].g;if(t-=r,0>t)r=Math.max(0,n[h].h-100),c=!1;else try{un(u,o,"req"+t+"_")}catch(t){e&&e(u)}}if(c){e=o.join("&");break t}}}return a=a.i.splice(0,t),b.F=a,e}function Un(a){a.g||a.u||(a.ba=1,Mt(a.Ma,a),a.A=0)}function jn(a){return!(a.g||a.u||3<=a.A)&&(a.ba++,a.u=ie(q(a.Ma,a),Kn(a,a.A)),a.A++,!0)}function Bn(a){null!=a.B&&(l.clearTimeout(a.B),a.B=null)}function qn(a){a.g=new pe(a,a.j,"rpc",a.ba),null===a.o&&(a.g.I=a.s),a.g.O=0;var b=Re(a.wa);Fe(b,"RID","rpc"),Fe(b,"SID",a.J),Fe(b,"CI",a.M?"0":"1"),Fe(b,"AID",a.V),Fe(b,"TYPE","xmlhttp"),Fn(a,b),a.o&&a.s&&kn(b,a.o,a.s),a.K&&a.g.setTimeout(a.K);var t=a.g;a=a.oa,t.L=1,t.v=Ve(Re(b)),t.s=null,t.S=!0,be(t,a)}function $n(a){null!=a.v&&(l.clearTimeout(a.v),a.v=null)}function zn(a,b){var t=null;if(a.g==b){$n(a),Bn(a),a.g=null;var e=2}else{if(!nn(a.h,b))return;t=b.F,sn(a.h,b),e=1}if(0!=a.H)if(a.ta=b.aa,b.i)if(1==e){t=b.s?b.s.length:0,b=Date.now()-b.G;var n=a.C;At(e=Xt(),new ne(e,t)),Ln(a)}else Un(a);else if(3==(n=b.o)||0==n&&0<a.ta||!(1==e&&function(a,b){return!(en(a.h)>=a.h.j-(a.m?1:0)||(a.m?(a.i=b.F.concat(a.i),0):1==a.H||2==a.H||a.C>=(a.cb?0:a.eb)||(a.m=ie(q(a.Na,a,b),Kn(a,a.C)),a.C++,0)))}(a,b)||2==e&&jn(a)))switch(t&&0<t.length&&(b=a.h,b.i=b.i.concat(t)),n){case 1:Gn(a,5);break;case 4:Gn(a,10);break;case 3:Gn(a,6);break;default:Gn(a,2)}}function Kn(a,b){let t=a.ab+Math.floor(Math.random()*a.hb);return a.l||(t*=2),t*b}function Gn(a,b){if(a.j.info("Error code "+b),2==b){var t=null;a.l&&(t=null);var e=q(a.pb,a);t||(t=new xe("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||Me(t,"https"),Ve(t)),function(a,b){const t=new Ht;if(l.Image){const e=new Image;e.onload=E(hn,t,e,"TestLoadImage: loaded",!0,b),e.onerror=E(hn,t,e,"TestLoadImage: error",!1,b),e.onabort=E(hn,t,e,"TestLoadImage: abort",!1,b),e.ontimeout=E(hn,t,e,"TestLoadImage: timeout",!1,b),l.setTimeout((function(){e.ontimeout&&e.ontimeout()}),1e4),e.src=a}else b(!1)}(t.toString(),e)}else ee(2);a.H=0,a.l&&a.l.za(b),Hn(a),Mn(a)}function Hn(a){if(a.H=0,a.pa=[],a.l){const b=on(a.h);0==b.length&&0==a.i.length||(A(a.pa,b),A(a.pa,a.i),a.h.i.length=0,C(a.i),a.i.length=0),a.l.ya()}}function Qn(a,b,t){var e=t instanceof xe?Re(t):new xe(t,void 0);if(""!=e.g)b&&(e.g=b+"."+e.g),Le(e,e.m);else{var n=l.location;e=n.protocol,b=b?b+"."+n.hostname:n.hostname,n=+n.port;var r=new xe(null,void 0);e&&Me(r,e),b&&(r.g=b),n&&Le(r,n),t&&(r.l=t),e=r}return t=a.F,b=a.Da,t&&b&&Fe(e,t,b),Fe(e,"VER",a.qa),Fn(a,e),e}function Wn(a,b,t){if(b&&!a.I)throw Error("Can't create secondary domain capable XhrIo object.");return(b=t&&a.Ha&&!a.va?new vn(new ln({ob:!0})):new vn(a.va)).Oa(a.I),b}function Yn(){}function Xn(){if(V&&!(10<=Number(X)))throw Error("Environmental error: no available transport.")}function Jn(a,b){Ct.call(this),this.g=new On(b),this.l=a,this.h=b&&b.messageUrlParams||null,a=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.s=a,a=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(a?a["X-WebChannel-Content-Type"]=b.messageContentType:a={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.Ca&&(a?a["X-WebChannel-Client-Profile"]=b.Ca:a={"X-WebChannel-Client-Profile":b.Ca}),this.g.U=a,(a=b&&b.cc)&&!k(a)&&(this.g.o=a),this.A=b&&b.supportsCrossDomainXhr||!1,this.v=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!k(b)&&(this.g.F=b,null!==(a=this.h)&&b in a&&(b in(a=this.h)&&delete a[b])),this.j=new ei(this)}function Zn(a){le.call(this);var b=a.__sm__;if(b){t:{for(const t in b){a=t;break t}a=void 0}(this.i=a)&&(a=this.i,b=null!==b&&a in b?b[a]:void 0),this.data=b}else this.data=a}function ti(){de.call(this),this.status=1}function ei(a){this.g=a}function ni(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function ii(a,b,t){t||(t=0);var e=Array(16);if("string"==typeof b)for(var n=0;16>n;++n)e[n]=b.charCodeAt(t++)|b.charCodeAt(t++)<<8|b.charCodeAt(t++)<<16|b.charCodeAt(t++)<<24;else for(n=0;16>n;++n)e[n]=b[t++]|b[t++]<<8|b[t++]<<16|b[t++]<<24;b=a.g[0],t=a.g[1],n=a.g[2];var r=a.g[3],o=b+(r^t&(n^r))+e[0]+3614090360&4294967295;o=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=(t=(n=(r=(b=t+(o<<7&4294967295|o>>>25))+((o=r+(n^b&(t^n))+e[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=n+(t^r&(b^t))+e[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(b^n&(r^b))+e[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=b+(r^t&(n^r))+e[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=r+(n^b&(t^n))+e[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=n+(t^r&(b^t))+e[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(b^n&(r^b))+e[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=b+(r^t&(n^r))+e[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=r+(n^b&(t^n))+e[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=n+(t^r&(b^t))+e[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(b^n&(r^b))+e[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=b+(r^t&(n^r))+e[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=r+(n^b&(t^n))+e[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=n+(t^r&(b^t))+e[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(b^n&(r^b))+e[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=b+(n^r&(t^n))+e[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=r+(t^n&(b^t))+e[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^t&(r^b))+e[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(r^b&(n^r))+e[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=b+(n^r&(t^n))+e[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=r+(t^n&(b^t))+e[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^t&(r^b))+e[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(r^b&(n^r))+e[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=b+(n^r&(t^n))+e[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=r+(t^n&(b^t))+e[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^t&(r^b))+e[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(r^b&(n^r))+e[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=b+(n^r&(t^n))+e[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=r+(t^n&(b^t))+e[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=n+(b^t&(r^b))+e[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(r^b&(n^r))+e[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=b+(t^n^r)+e[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^t^n)+e[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^t)+e[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(n^r^b)+e[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=b+(t^n^r)+e[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^t^n)+e[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^t)+e[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(n^r^b)+e[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=b+(t^n^r)+e[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^t^n)+e[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^t)+e[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(n^r^b)+e[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=b+(t^n^r)+e[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=r+(b^t^n)+e[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=n+(r^b^t)+e[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(n^r^b)+e[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=b+(n^(t|~r))+e[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=r+(t^(b|~n))+e[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=n+(b^(r|~t))+e[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(r^(n|~b))+e[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=b+(n^(t|~r))+e[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=r+(t^(b|~n))+e[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=n+(b^(r|~t))+e[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(r^(n|~b))+e[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=b+(n^(t|~r))+e[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=r+(t^(b|~n))+e[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=n+(b^(r|~t))+e[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(r^(n|~b))+e[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((r=(b=t+((o=b+(n^(t|~r))+e[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=r+(t^(b|~n))+e[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((n=r+((o=n+(b^(r|~t))+e[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~b))+e[9]+3951481745&4294967295,a.g[0]=a.g[0]+b&4294967295,a.g[1]=a.g[1]+(n+(o<<21&4294967295|o>>>11))&4294967295,a.g[2]=a.g[2]+n&4294967295,a.g[3]=a.g[3]+r&4294967295}function ri(a,b){this.h=b;for(var t=[],e=!0,n=a.length-1;0<=n;n--){var r=0|a[n];e&&r==b||(t[n]=r,e=!1)}this.g=t}(r=vn.prototype).Oa=function(a){this.M=a},r.ha=function(a,b,t,e){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+a);b=b?b.toUpperCase():"GET",this.I=a,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ue.g(),this.C=this.u?ae(this.u):ae(ue),this.g.onreadystatechange=q(this.La,this);try{this.G=!0,this.g.open(b,String(a),!0),this.G=!1}catch(t){return void En(this,t)}if(a=t||"",t=new Map(this.headers),e)if(Object.getPrototypeOf(e)===Object.prototype)for(var n in e)t.set(n,e[n]);else{if("function"!=typeof e.keys||"function"!=typeof e.get)throw Error("Unknown input type for opt_headers: "+String(e));for(const n of e.keys())t.set(n,e.get(n))}e=Array.from(t.keys()).find((t=>"content-type"==t.toLowerCase())),n=l.FormData&&a instanceof l.FormData,!(0<=S(bn,b))||e||n||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,n]of t)this.g.setRequestHeader(e,n);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Cn(this),0<this.B&&((this.L=function(a){return V&&L(W,9,(function(){let a=0;const b=N(String(P)).split("."),t=N("9").split("."),e=Math.max(b.length,t.length);for(let o=0;0==a&&o<e;o++){var n=b[o]||"",r=t[o]||"";do{if(n=/(\d*)(\D*)(.*)/.exec(n)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],0==n[0].length&&0==r[0].length)break;a=O(0==n[1].length?0:parseInt(n[1],10),0==r[1].length?0:parseInt(r[1],10))||O(0==n[2].length,0==r[2].length)||O(n[2],r[2]),n=n[3],r=r[3]}while(0==a)}return 0<=a}))&&"number"==typeof a.timeout&&void 0!==a.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q(this.ua,this)):this.A=jt(this.ua,this.B,this)),this.v=!0,this.g.send(a),this.v=!1}catch(t){En(this,t)}},r.ua=function(){void 0!==h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,At(this,"timeout"),this.abort(8))},r.abort=function(a){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=a||7,At(this,"complete"),At(this,"abort"),Sn(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Sn(this,!0)),vn.$.N.call(this)},r.La=function(){this.s||(this.G||this.v||this.l?Tn(this):this.kb())},r.kb=function(){Tn(this)},r.da=function(){try{return 2<An(this)?this.g.status:-1}catch(t){return-1}},r.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},r.Wa=function(a){if(this.g){var b=this.g.responseText;return a&&0==b.indexOf(a)&&(b=b.substring(a.length)),yn(b)}},r.Ia=function(){return this.m},r.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=On.prototype).qa=8,r.H=1,r.Na=function(a){if(this.m)if(this.m=null,1==this.H){if(!a){this.W=Math.floor(1e5*Math.random()),a=this.W++;const n=new pe(this,this.j,a,void 0);let r=this.s;if(this.U&&(r?(r=ot(r),ct(r,this.U)):r=this.U),null!==this.o||this.O||(n.I=r,r=null),this.P)t:{for(var b=0,t=0;t<this.i.length;t++){var e=this.i[t];if(void 0===(e="__data__"in e.g&&"string"==typeof(e=e.g.__data__)?e.length:void 0))break;if(4096<(b+=e)){b=t;break t}if(4096===b||t===this.i.length-1){b=t+1;break t}}b=1e3}else b=1e3;b=Vn(this,n,b),Fe(t=Re(this.G),"RID",a),Fe(t,"CVER",22),this.F&&Fe(t,"X-HTTP-Session-Id",this.F),Fn(this,t),r&&(this.O?b="headers="+encodeURIComponent(String(Dn(r)))+"&"+b:this.o&&kn(t,this.o,r)),rn(this.h,n),this.bb&&Fe(t,"TYPE","init"),this.P?(Fe(t,"$req",b),Fe(t,"SID","null"),n.ba=!0,we(n,t,null)):we(n,t,b),this.H=2}}else 3==this.H&&(a?Pn(this,a):0==this.i.length||tn(this.h)||Pn(this))},r.Ma=function(){if(this.u=null,qn(this),this.ca&&!(this.L||null==this.g||0>=this.S)){var a=2*this.S;this.j.info("BP detection timer enabled: "+a),this.B=ie(q(this.jb,this),a)}},r.jb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.M=!1,this.L=!0,ee(10),Rn(this),qn(this))},r.ib=function(){null!=this.v&&(this.v=null,Rn(this),jn(this),ee(19))},r.pb=function(a){a?(this.j.info("Successfully pinged google.com"),ee(2)):(this.j.info("Failed to ping google.com"),ee(1))},(r=Yn.prototype).Ba=function(){},r.Aa=function(){},r.za=function(){},r.ya=function(){},r.Va=function(){},Xn.prototype.g=function(a,b){return new Jn(a,b)},I(Jn,Ct),Jn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.I=!0);var a=this.g,b=this.l,t=this.h||void 0;ee(0),a.Y=b,a.ma=t||{},a.M=a.aa,a.G=Qn(a,null,a.Y),Ln(a)},Jn.prototype.close=function(){xn(this.g)},Jn.prototype.u=function(a){var b=this.g;if("string"==typeof a){var t={};t.__data__=a,a=t}else this.v&&((t={}).__data__=Dt(a),a=t);b.i.push(new class{constructor(a,b){this.h=a,this.g=b}}(b.fb++,a)),3==b.H&&Ln(b)},Jn.prototype.N=function(){this.g.l=null,delete this.j,xn(this.g),delete this.g,Jn.$.N.call(this)},I(Zn,le),I(ti,de),I(ei,Yn),ei.prototype.Ba=function(){At(this.g,"a")},ei.prototype.Aa=function(a){At(this.g,new Zn(a))},ei.prototype.za=function(a){At(this.g,new ti)},ei.prototype.ya=function(){At(this.g,"b")},I(ni,(function(){this.blockSize=-1})),ni.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},ni.prototype.j=function(a,b){void 0===b&&(b=a.length);for(var t=b-this.blockSize,e=this.m,n=this.h,r=0;r<b;){if(0==n)for(;r<=t;)ii(this,a,r),r+=this.blockSize;if("string"==typeof a){for(;r<b;)if(e[n++]=a.charCodeAt(r++),n==this.blockSize){ii(this,e),n=0;break}}else for(;r<b;)if(e[n++]=a[r++],n==this.blockSize){ii(this,e),n=0;break}}this.h=n,this.i+=b},ni.prototype.l=function(){var a=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);a[0]=128;for(var b=1;b<a.length-8;++b)a[b]=0;var t=8*this.i;for(b=a.length-8;b<a.length;++b)a[b]=255&t,t/=256;for(this.j(a),a=Array(16),b=t=0;4>b;++b)for(var e=0;32>e;e+=8)a[t++]=this.g[b]>>>e&255;return a};var si={};function oi(a){return-128<=a&&128>a?L(si,a,(function(b){return new ri([0|b],0>b?-1:0)})):new ri([0|a],0>a?-1:0)}function ai(a){if(isNaN(a)||!isFinite(a))return ui;if(0>a)return gi(ai(-a));for(var b=[],t=1,e=0;a>=t;e++)b[e]=a/t|0,t*=ci;return new ri(b,0)}var ci=4294967296,ui=oi(0),hi=oi(1),di=oi(16777216);function fi(a){if(0!=a.h)return!1;for(var b=0;b<a.g.length;b++)if(0!=a.g[b])return!1;return!0}function pi(a){return-1==a.h}function gi(a){for(var b=a.g.length,t=[],e=0;e<b;e++)t[e]=~a.g[e];return new ri(t,~a.h).add(hi)}function mi(a,b){return a.add(gi(b))}function yi(a,b){for(;(65535&a[b])!=a[b];)a[b+1]+=a[b]>>>16,a[b]&=65535,b++}function vi(a,b){this.g=a,this.h=b}function wi(a,b){if(fi(b))throw Error("division by zero");if(fi(a))return new vi(ui,ui);if(pi(a))return b=wi(gi(a),b),new vi(gi(b.g),gi(b.h));if(pi(b))return b=wi(a,gi(b)),new vi(gi(b.g),b.h);if(30<a.g.length){if(pi(a)||pi(b))throw Error("slowDivide_ only works with positive integers.");for(var t=hi,e=b;0>=e.X(a);)t=bi(t),e=bi(e);var n=Ei(t,1),r=Ei(e,1);for(e=Ei(e,2),t=Ei(t,2);!fi(e);){var o=r.add(e);0>=o.X(a)&&(n=n.add(t),r=o),e=Ei(e,1),t=Ei(t,1)}return b=mi(a,n.R(b)),new vi(n,b)}for(n=ui;0<=a.X(b);){for(t=Math.max(1,Math.floor(a.ea()/b.ea())),e=48>=(e=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,e-48),o=(r=ai(t)).R(b);pi(o)||0<o.X(a);)o=(r=ai(t-=e)).R(b);fi(r)&&(r=hi),n=n.add(r),a=mi(a,o)}return new vi(n,a)}function bi(a){for(var b=a.g.length+1,t=[],e=0;e<b;e++)t[e]=a.D(e)<<1|a.D(e-1)>>>31;return new ri(t,a.h)}function Ei(a,b){var t=b>>5;b%=32;for(var e=a.g.length-t,n=[],r=0;r<e;r++)n[r]=0<b?a.D(r+t)>>>b|a.D(r+t+1)<<32-b:a.D(r+t);return new ri(n,a.h)}(r=ri.prototype).ea=function(){if(pi(this))return-gi(this).ea();for(var a=0,b=1,t=0;t<this.g.length;t++){var e=this.D(t);a+=(0<=e?e:ci+e)*b,b*=ci}return a},r.toString=function(a){if(2>(a=a||10)||36<a)throw Error("radix out of range: "+a);if(fi(this))return"0";if(pi(this))return"-"+gi(this).toString(a);for(var b=ai(Math.pow(a,6)),t=this,e="";;){var n=wi(t,b).g,r=((0<(t=mi(t,n.R(b))).g.length?t.g[0]:t.h)>>>0).toString(a);if(fi(t=n))return r+e;for(;6>r.length;)r="0"+r;e=r+e}},r.D=function(a){return 0>a?0:a<this.g.length?this.g[a]:this.h},r.X=function(a){return pi(a=mi(this,a))?-1:fi(a)?0:1},r.abs=function(){return pi(this)?gi(this):this},r.add=function(a){for(var b=Math.max(this.g.length,a.g.length),t=[],e=0,n=0;n<=b;n++){var r=e+(65535&this.D(n))+(65535&a.D(n)),o=(r>>>16)+(this.D(n)>>>16)+(a.D(n)>>>16);e=o>>>16,r&=65535,o&=65535,t[n]=o<<16|r}return new ri(t,-2147483648&t[t.length-1]?-1:0)},r.R=function(a){if(fi(this)||fi(a))return ui;if(pi(this))return pi(a)?gi(this).R(gi(a)):gi(gi(this).R(a));if(pi(a))return gi(this.R(gi(a)));if(0>this.X(di)&&0>a.X(di))return ai(this.ea()*a.ea());for(var b=this.g.length+a.g.length,t=[],e=0;e<2*b;e++)t[e]=0;for(e=0;e<this.g.length;e++)for(var n=0;n<a.g.length;n++){var r=this.D(e)>>>16,o=65535&this.D(e),c=a.D(n)>>>16,h=65535&a.D(n);t[2*e+2*n]+=o*h,yi(t,2*e+2*n),t[2*e+2*n+1]+=r*h,yi(t,2*e+2*n+1),t[2*e+2*n+1]+=o*c,yi(t,2*e+2*n+1),t[2*e+2*n+2]+=r*c,yi(t,2*e+2*n+2)}for(e=0;e<b;e++)t[e]=t[2*e+1]<<16|t[2*e];for(e=b;e<2*b;e++)t[e]=0;return new ri(t,0)},r.gb=function(a){return wi(this,a).h},r.and=function(a){for(var b=Math.max(this.g.length,a.g.length),t=[],e=0;e<b;e++)t[e]=this.D(e)&a.D(e);return new ri(t,this.h&a.h)},r.or=function(a){for(var b=Math.max(this.g.length,a.g.length),t=[],e=0;e<b;e++)t[e]=this.D(e)|a.D(e);return new ri(t,this.h|a.h)},r.xor=function(a){for(var b=Math.max(this.g.length,a.g.length),t=[],e=0;e<b;e++)t[e]=this.D(e)^a.D(e);return new ri(t,this.h^a.h)},Xn.prototype.createWebChannel=Xn.prototype.g,Jn.prototype.send=Jn.prototype.u,Jn.prototype.open=Jn.prototype.m,Jn.prototype.close=Jn.prototype.close,re.NO_ERROR=0,re.TIMEOUT=8,re.HTTP_ERROR=6,se.COMPLETE="complete",ce.EventType=he,he.OPEN="a",he.CLOSE="b",he.ERROR="c",he.MESSAGE="d",Ct.prototype.listen=Ct.prototype.O,vn.prototype.listenOnce=vn.prototype.P,vn.prototype.getLastError=vn.prototype.Sa,vn.prototype.getLastErrorCode=vn.prototype.Ia,vn.prototype.getStatus=vn.prototype.da,vn.prototype.getResponseJson=vn.prototype.Wa,vn.prototype.getResponseText=vn.prototype.ja,vn.prototype.send=vn.prototype.ha,vn.prototype.setWithCredentials=vn.prototype.Oa,ni.prototype.digest=ni.prototype.l,ni.prototype.reset=ni.prototype.reset,ni.prototype.update=ni.prototype.j,ri.prototype.add=ri.prototype.add,ri.prototype.multiply=ri.prototype.R,ri.prototype.modulo=ri.prototype.gb,ri.prototype.compare=ri.prototype.X,ri.prototype.toNumber=ri.prototype.ea,ri.prototype.toString=ri.prototype.toString,ri.prototype.getBits=ri.prototype.D,ri.fromNumber=ai,ri.fromString=function t(a,b){if(0==a.length)throw Error("number format error: empty string");if(2>(b=b||10)||36<b)throw Error("radix out of range: "+b);if("-"==a.charAt(0))return gi(t(a.substring(1),b));if(0<=a.indexOf("-"))throw Error('number format error: interior "-" character');for(var e=ai(Math.pow(b,8)),n=ui,r=0;r<a.length;r+=8){var o=Math.min(8,a.length-r),c=parseInt(a.substring(r,r+o),b);8>o?(o=ai(Math.pow(b,o)),n=n.R(o).add(ai(c))):n=(n=n.R(e)).add(ai(c))}return n};var Ii=c.createWebChannelTransport=function(){return new Xn},Ti=c.getStatEventTarget=function(){return Xt()},Si=c.ErrorCode=re,Ci=c.EventType=se,Ai=c.Event=Wt,_i=c.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Di=c.FetchXmlHttpFactory=ln,ki=c.WebChannel=ce,Ni=c.XhrIo=vn,Oi=c.Md5=ni,xi=c.Integer=ri}).call(this,n(42))}}]);